
---
layout: post
title: "è‡ªå»ºå±€åŸŸç½‘ OTA æœåŠ¡å™¨"
date: 2018-11-10 
description: "iOS é€šè¿‡å±€åŸŸç½‘ä¸‹è½½å®‰è£… ipa"
tag: iOS 
--- 

* [ç¬¬ä¸€æ­¥ ç¼–è¾‘å‰çš„å‡†å¤‡](#1_0)
* [ç¬¬äºŒæ­¥ é…ç½®HttpæœåŠ¡](#2_0)
* [ç¬¬ä¸‰æ­¥ ç”Ÿæˆè‡ªç­¾åè¯ä¹¦](#3_0)
* [ç¬¬å››æ­¥ é…ç½®HTTPSæœåŠ¡](#4_0)
* [ç¬¬äº”æ­¥ æ”¾ç½®èµ„æºæ–‡ä»¶](#5_0)
* [å‚è€ƒé“¾æ¥](#6_0)

## <a id="1_0"></a>ç¬¬ä¸€æ­¥ ç¼–è¾‘å‰çš„å‡†å¤‡

#### 1.1 Macè‡ªå¸¦ Apache æœåŠ¡å™¨

Mac è‡ªå¸¦ Apache æœåŠ¡å™¨ï¼Œæˆ‘ä»¬åœ¨ç»ˆç«¯è¾“å…¥` sudo apachectl -k start `æ‰“å¼€ç½‘é¡µè¾“å…¥` localhost`ï¼Œå‘ç°ç½‘é¡µä¼šæ˜¾ç¤ºå¦‚ä¸‹ï¼š

##### It works!

Apache æœåŠ¡å™¨å¯åŠ¨æˆåŠŸã€‚

#### 1.2 ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶å‰å…ˆå¤‡ä»½

ä¾‹å¦‚éœ€è¦ä¿®æ”¹` /etc/apache2 `æ–‡ä»¶å¤¹ä¸‹ http.conf æ–‡ä»¶

1. åˆ‡æ¢å·¥ä½œç›®å½•ä¸‹ï¼š

` cd /etc/apache2 `

2. å¤‡ä»½æ–‡ä»¶ï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼š

` sudo cp httpd.conf httpd.conf.bak `

3. å¦‚æœæ“ä½œå‡ºç°é”™è¯¯ï¼å¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼Œæ¢å¤å¤‡ä»½çš„ httpd.conf æ–‡ä»¶ï¼š

` sudo cp httpd.conf.bak httpd.conf `

#### 1.3 é€šè¿‡ Xcode æˆ–è€… vim ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶

é€šè¿‡ Xcode ä¿®æ”¹æ¯”è¾ƒç®€å•ï¼Œå°†æ–‡ä»¶è„±å‡ºåˆ°æ¡Œé¢ä¸€ä»½ï¼Œä¿®æ”¹åæ‹–å›åŸæ¥çš„æ–‡ä»¶å¤¹è¦†ç›–å³å¯ã€‚

æ³¨æ„çš„æ˜¯ï¼Œåœ¨**ç³»ç»Ÿç›®å½•ä¸‹æ˜¯ä¸å¯ä»¥ç›´æ¥ç”¨ Xcode ä¿®æ”¹**çš„ï¼Œå¯å°†æ–‡ä»¶å¤åˆ¶åˆ°æ¡Œé¢ä¸Šï¼Œç”¨ Xcode æ‰“å¼€ä¿®æ”¹ï¼Œç„¶åæ‹–å…¥ç³»ç»Ÿç›®å½•ä¸‹è¦†ç›–å³å¯ã€‚

é€šè¿‡ vim ä¿®æ”¹æ–‡ä»¶ï¼Œå¯ç›´æ¥ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ï¼Œä¿®æ”¹æ¯”è¾ƒæ–¹ä¾¿ã€‚ä»¥ä¸‹ä¿®æ”¹ç³»ç»Ÿé…ç½®æ–‡ä»¶ç”¨åˆ°vimï¼Œå¦‚æœä¸ä¹ æƒ¯ä½¿ç”¨vimä¿®æ”¹ï¼Œå¯ä½¿ç”¨ Xcode ç¼–è¾‘ä¿®æ”¹ã€‚

#### 1.4 vim ç®€å•æ“ä½œ

1. ä¾‹å¦‚å½“å‰ç›®å½•ä¸‹æœ‰ä¸€ä¸ª httpd.conf æ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹ç¬¬ 100 è¡Œä¸º abcdefã€‚
2. è¾“å…¥å‘½ä»¤` sudo vim httpd.conf `ã€‚
3. é¼ æ ‡æ»šåŠ¨æˆ–è€…æŒ‰ä¸Šä¸‹é”®å…‰æ ‡ç§»åŠ¨åˆ°ç¬¬ 100 è¡Œï¼ŒæŒ‰ i é”®è¿›å…¥ç¼–è¾‘æ¨¡å¼
å°†ç¬¬ 100 è¡Œå†…å®¹åˆ é™¤å¹¶æ›¿æ¢ä¸º abcdef ã€‚
4. æŒ‰` esc `é”®é€€å‡ºç¼–è¾‘ã€‚
5. è¾“å…¥` :wq `é€€å‡ºå¹¶ä¿å­˜ï¼›å¦‚æœç¼–è¾‘é”™è¯¯è¾“å…¥`:q! `ä¸ä¿å­˜æ–‡ä»¶ï¼Œå¼ºåˆ¶é€€å‡ºviã€‚

## <a id="2_0"></a>ç¬¬äºŒæ­¥ é…ç½®HttpæœåŠ¡

#### 2.1 åˆ›å»º web æ–‡ä»¶å¤¹

æˆ‘ä»¬åœ¨å½“å‰ç”¨æˆ·æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªwebæ–‡ä»¶å¤¹ï¼Œç„¶åæ”¾å…¥ä¸€äº›æ–‡ä»¶ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š

![web æ–‡ä»¶å¤¹](https://raw.githubusercontent.com/muzipiao/GitHubImages/master/ota/ota2.1.png)

#### 2.2 ç¼–è¾‘ http.conf æ–‡ä»¶

1. åˆ‡æ¢å·¥ä½œç›®å½•ä¸‹ï¼š` cd /etc/apache2 `
2. å¤‡ä»½æ–‡ä»¶ï¼š` sudo cp httpd.conf httpd.conf.bak `
3. ç”¨vimç¼–è¾‘httpd.confæ–‡ä»¶ï¼š` sudo vim httpd.conf `

4. å°†ä¸‹é¢è·¯å¾„æ›´æ”¹ä¸ºä½ è‡ªå·±webç½‘é¡µè·¯å¾„ï¼ˆçº¦245è¡Œï¼‰

```shell
DocumentRoot "/Library/WebServer/Documents"
<Directory "/Library/WebServer/Documentsâ€>

ä¿®æ”¹ä¸ºæˆ‘å½“å‰ç”¨æˆ·ç›®å½•ä¸‹å»ºç«‹çš„ä¸€ä¸ª web æ–‡ä»¶å¤¹

DocumentRoot "/Users/lf/web"
<Directory "/Users/lf/webâ€>
```

5. ä¸ºäº†ä¾¿äºæµè§ˆ web æ–‡ä»¶å¤¹ï¼Œæ·»åŠ  Indexes å­—æ®µ

```shell
Options FollowSymLinks Multiviews

ä¿®æ”¹ä¸º

Options Indexes FollowSymLinks Multiviews
```

![ä¿®æ”¹httpd](https://raw.githubusercontent.com/muzipiao/GitHubImages/master/ota/ota2.2.5.png)

6. å°†ä¸‹é¢çš„#å·æ³¨é‡Šå»æ‰ï¼Œå¼€å¯PHPï¼ˆçº¦177è¡Œï¼‰

```shell
#LoadModule php7_module libexec/apache2/libphp7.so

ä¿®æ”¹ä¸º

LoadModule php7_module libexec/apache2/libphp7.so

è¾ƒæ—§çš„ç³»ç»Ÿä¸ºï¼ˆ#LoadModule php5_module libexec/apache2/libphp5.soï¼‰
```

![å¼€å¯PHP](https://raw.githubusercontent.com/muzipiao/GitHubImages/master/ota/ota2.2.6.png)

7. ç„¶åæŒ‰ ESC é”®é€€å‡ºç¼–è¾‘ï¼Œè¾“å…¥` :wq `ä¿å­˜é€€å‡ºã€‚

8. ç»ˆç«¯ä¸­è¾“å…¥` sudo apachectl -k restart `é‡å¯ Apache æœåŠ¡å™¨ã€‚

9. å¼€å¯ apache æœåŠ¡å™¨.æ‰“å¼€æµè§ˆå™¨,æœç´¢æ¡†ä¸­è¾“å…¥` 127.0.0.1 `æˆ–è€…` localhost `å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¹‹å‰æ·»åŠ çš„ç½‘ç»œèµ„æºã€‚

![å¼€å¯HTTPæœåŠ¡æˆåŠŸ](https://raw.githubusercontent.com/muzipiao/GitHubImages/master/ota/ota2.2.9.png)

#### 2.3 Apache å¸¸ç”¨æ“ä½œå‘½ä»¤

```shell
# å¯åŠ¨ apache æœåŠ¡å™¨
sudo apachectl -k start

# é‡æ–°å¯åŠ¨ apache æœåŠ¡å™¨
sudo apachectl -k restart

# å…³é—­ apache æœåŠ¡å™¨
sudo apachectl -k stop
```

#### 2.4 é‡å¯æ—¶æŠ¥é”™ 

é‡å¯çš„æ—¶å€™å‘ç°æŠ¥é”™ï¼Œä½†ä¸å½±å“ä½¿ç”¨

![ServerNameé”™è¯¯](https://raw.githubusercontent.com/muzipiao/GitHubImages/master/ota/ota2.4.png)

```text
AH00558: httpd: Could not reliably determine the server's fully

qualified domain name, using LFdeMacBook-Pro.local. Set the

'ServerName' directive globally to suppress this message
```

å¦‚æœæƒ³è§£å†³æ­¤æŠ¥é”™ï¼Œå¯å†æ¬¡ç¼–è¾‘ httpd.conf æ–‡ä»¶

` sudo vim httpd.conf `

å°†ä¸‹é¢çš„#å·æ³¨é‡Šå»æ‰ï¼Œå¹¶ä¿®æ”¹ï¼ˆçº¦221è¡Œï¼‰

```shell
#ServerName www.example.com:80

ä¿®æ”¹ä¸º

ServerName localhost:80
```

ç„¶åç»ˆç«¯è¾“å…¥ä¸‹é¢æŒ‡ä»¤é‡å¯å³å¯ã€‚


```shell
sudo apachectl -k restart
```

## <a id="3_0"></a>ç¬¬ä¸‰æ­¥ ç”Ÿæˆè‡ªç­¾åè¯ä¹¦

> iOS7.1 ä»¥åï¼Œ Apple ä¸å†æ”¯æŒ HTTP æ–¹å¼çš„ OTA ï¼Œæ‰€ä»¥éœ€è¦ä¸º Apache å¼€å¯ HTTPS æœåŠ¡ï¼Œå¹¶åˆ©ç”¨ OpenSSL åˆ¶ä½œè‡ªç­¾åè¯ä¹¦ã€‚

#### 3.1 ç”ŸæˆæœåŠ¡å™¨ç§é’¥ server.key

```shell
sudo mkdir /private/etc/apache2/ssl 

cd /private/etc/apache2/ssl

sudo openssl genrsa -out server.key 1024
```

ç”Ÿæˆå¦‚ä¸‹æ‰€ç¤ºæ–‡ä»¶

![æœåŠ¡å™¨ç§é’¥](https://raw.githubusercontent.com/muzipiao/GitHubImages/master/ota/ota3.1.png)


#### 3.2 ç”Ÿæˆç­¾ç½²ç”³è¯·

```shell
sudo openssl req -new -key server.key -out server.csr
```

æ³¨æ„ï¼šéœ€è¦å®Œæ•´å¡«å†™å„é¡¹ä¿¡æ¯ï¼Œæ³¨æ„` Common Name `å¿…é¡»æ˜¯æœåŠ¡å™¨ ip æˆ–åŸŸåï¼Œå…¶ä»–ä¿¡æ¯å¯ä»¥éšæ„å¡«å†™ã€‚ä¾‹å¦‚æˆ‘éœ€è¦æŠŠ ipa å®‰è£…åŒ…æ”¾åœ¨ 192.168.1.188 çš„å†…ç½‘æœåŠ¡å™¨ä¸Šï¼Œåˆ™` Common Name `å°±å¡«å†™ 192.168.1.188 ã€‚å¦‚æœè¿™ä¸€æ­¥æ¼å¡«ä¿¡æ¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœ€åç”Ÿæˆçš„ ca æ–‡ä»¶æ˜¯ç©ºçš„ã€‚

![ç”Ÿæˆserver.csr](https://raw.githubusercontent.com/muzipiao/GitHubImages/master/ota/ota3.2.png)

#### 3.3 ç”Ÿæˆ CA ç§é’¥ca.crt

```shell
sudo openssl req  -new -x509 -days 365 -key server.key -out ca.crt
```

å¡«å†™ä¿¡æ¯å’Œä¸Šé¢çš„å¡«å†™çš„ä¸€æ ·å³å¯ï¼Œæ³¨æ„` Common Name `å¿…é¡»å¡«å†™ï¼Œè¿™é‡Œè¿˜æ˜¯å¡«å†™192.168.1.188å³å¯ã€‚

![ç”Ÿæˆca.crt](https://raw.githubusercontent.com/muzipiao/GitHubImages/master/ota/ota3.3.png)

#### 3.4 åˆ›å»ºæ–‡ä»¶å’Œæ–‡ä»¶å¤¹

åœ¨ ssl ç›®å½•ä¸‹åˆ›å»º demoCA æ–‡ä»¶å¤¹ï¼Œç„¶åè¿›å…¥ demoCA ï¼Œåˆ›å»ºä¸€ä¸ª index.txt å’Œ serialæ–‡ä»¶ï¼Œindex.txt ä¸ºç©ºï¼Œ serial å†…å®¹ä¸º01ï¼Œç„¶ååœ¨ demoCA ä¸­å†åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ newcerts


```shell
sudo mkdir demoCA && cd demoCA

sudo mkdir newcerts

sudo touch index.txt

sudo touch serial
```

ä½¿ç”¨ Xcode æˆ–è€… vim ç¼–è¾‘ serial æ–‡ä»¶ï¼Œç¬¬ä¸€è¡Œå†™å…¥ 01 ä¿å­˜å³å¯ã€‚

#### 3.5 ç­¾åç”Ÿæˆserver.crt

æ‰§è¡Œå‘½ä»¤ï¼Œè¿”å›åˆ°sslæ–‡ä»¶å¤¹ä¸‹é¢

```shell
cd /private/etc/apache2/ssl
```

ç„¶åæ‰§è¡Œå‘½ä»¤ï¼Œç”¨caè¿›è¡Œç­¾åç”Ÿæˆserver.crt

```shell
sudo openssl ca -in server.csr -out server.crt -cert ca.crt -keyfile server.key
```

è¿™ä¸€æ­¥å¯èƒ½ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯

```text
Using configuration from /private/etc/ssl/openssl.cnf

variable lookup failed for ca::default_ca140736040362952:

error:0E06D06C:configuration file routines:NCONF_get_string:

no value:/BuildRoot/Library/Caches/com.apple.xbs/Sources/libressl/

libressl-22.50.2/libressl/crypto/conf/conf_lib.c:323:group=ca name=default_ca
```

è¿™æ˜¯ç”±äº` /private/etc/ssl/ `æ–‡ä»¶å¤¹ä¸‹ç¼ºå°‘ openssl.cnf çš„é—®é¢˜ï¼Œè§£å†³åŠæ³•æ˜¯æ‹·è´ä¸€ä»½ï¼Œè¾“å…¥å‘½ä»¤

```shell
cp /usr/local/etc/openssl/openssl.cnf /private/etc/ssl/openssl.cnf
```

ä½¿ç”¨Xcodeæˆ–è€…vimä¿®æ”¹` /private/etc/ssl/openssl.cnf `æ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨vimç›´æ¥ä¿®æ”¹

```shell
sudo vim /private/etc/ssl/openssl.cnf
```

```shell
dir        = ./demoCA        # Where everything is kept
ä¿®æ”¹ä¸ºå½“å‰ä½ çš„demoCAè·¯å¾„
dir        =  /private/etc/apache2/ssl/demoCA
```

ä¿®æ”¹å®Œæˆåå†æ‰§è¡Œå‘½ä»¤

```shell
sudo openssl ca -in server.csr -out server.crt -cert ca.crt -keyfile server.key
```

ä¼šæç¤ºæœ‰æ•ˆæœŸå’Œç”Ÿæˆè¯ä¹¦ï¼Œéƒ½è¾“å…¥yå³å¯ã€‚

![ç”Ÿæˆè¯ä¹¦æˆåŠŸæç¤º](https://raw.githubusercontent.com/muzipiao/GitHubImages/master/ota/ota3.5.1.png)

```text
Certificate is to be certified until Nov 10 06:39:36 2019 GMT (365 days)
Sign the certificate? [y/n]:y
ï¼ˆç¿»è¯‘ï¼‰è¯ä¹¦æœ‰æ•ˆæœŸè‡³11æœˆ10æ—¥06:39:36 2019 GMT(365å¤©)
1 out of 1 certificate requests certified, commit? [y/n]y
ç­¾ç½²çš„è¯ä¹¦å—?
ï¼ˆç¿»è¯‘ï¼‰1 / 1çš„è¯ä¹¦è¯·æ±‚è¢«è®¤è¯ï¼Œæäº¤?
```

æ­¤æ—¶æˆ‘ä»¬çœ‹åˆ° HTTPS è¯ä¹¦å·²ç»ç”Ÿæˆå®Œæˆã€‚

![è¯ä¹¦åˆ—è¡¨](https://raw.githubusercontent.com/muzipiao/GitHubImages/master/ota/ota3.5.2.png)

## <a id="4_0"></a>ç¬¬å››æ­¥ é…ç½®HTTPSæœåŠ¡

#### 4.1 ç¼–è¾‘ httpd.conf æ–‡ä»¶

```shell
sudo vim /private/etc/apache2/httpd.conf
```

æŠŠä»¥ä¸‹å››è¡Œä»£ç å‰å¤´çš„æ³¨é‡Šå»æ‰

```text
LoadModule ssl_module libexec/apache2/mod_ssl.so

LoadModule socache_shmcb_module

libexec/apache2/mod_socache_shmcb.so

Include /private/etc/apache2/extra/httpd-ssl.conf

Include /private/etc/apache2/extra/httpd-vhosts.conf
```

æ³¨æ„ï¼šå¦‚æœä½ çš„ httpd.conf ä¸­ç¼ºå°‘äº†æŸè¡Œï¼Œä½ å¯ä»¥è‡ªè¡Œæ·»åŠ è¿›å»å³å¯ã€‚


#### 4.2 ç¼–è¾‘ httpd-ssl.conf æ–‡ä»¶

ç¼–è¾‘å‰å…ˆå¤‡ä»½ httpd-ssl.conf æ–‡ä»¶

```shell
cd /private/etc/apache2/extra/ && sudo cp httpd-ssl.conf httpd-ssl.conf.bak

sudo vim /private/etc/apache2/extra/httpd-ssl.conf
```

æŠŠä»¥ä¸‹ä¸¤è¡Œä»£ç çš„æ³¨é‡Šå»æ‰ï¼Œå¹¶ç¼–è¾‘ä¸ºä½ çš„è¯ä¹¦è·¯å¾„

```text
SSLCertificateFile "/private/etc/apache2/server.crt"
SSLCertificateKeyFile "/private/etc/apache2/server.key"

ç„¶åä¿®æ”¹è·¯å¾„ï¼Œæ”¹æˆä½ çš„è¯ä¹¦æ–‡ä»¶è·¯å¾„

SSLCertificateFile "/private/etc/apache2/ssl/server.crt"
SSLCertificateKeyFile "/private/etc/apache2/ssl/server.key"
```

#### 4.3 ç¼–è¾‘ httpd-vhosts.conf æ–‡ä»¶

ç¼–è¾‘å‰å…ˆå¤‡ä»½ httpd-vhosts.conf æ–‡ä»¶

```shell
cd /private/etc/apache2/extra/ && sudo cp httpd-vhosts.conf httpd-vhosts.conf.bak

sudo vim /private/etc/apache2/extra/httpd-vhosts.conf
```

å°† <VirtualHost *:80> ä¸­çš„ç¬¬äºŒä¸ªä¿®æ”¹

```text
<VirtualHost *:80>
ServerAdmin 192.168.1.188
DocumentRoot "/Users/lf/web"
ServerName 192.168.1.188
ErrorLog "/private/var/log/apache2/dummy-host2.example.com-error_log"
CustomLog "/private/var/log/apache2/dummy-host2.example.com-access_log" common
</VirtualHost>
```

ç„¶ååœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ  443 ç«¯å£æœåŠ¡

```text
<VirtualHost *:443> 
SSLEngine on 
SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
SSLCertificateFile /private/etc/apache2/ssl/server.crt
SSLCertificateKeyFile /private/etc/apache2/ssl/server.key
ServerName 192.168.1.188
DocumentRoot "/Users/lf/web"
</VirtualHost>
```

æ³¨æ„ï¼š

- SSLCertificateFile å¡«å†™ç”Ÿæˆçš„ server.crt
- SSLCertificateKeyFile å¡«å†™ç”Ÿæˆçš„ server.key
- ServerName å¡«å†™ä½ çš„ ip
- DocumentRoot å¡«å†™ä½ çš„ç«™ç‚¹è·¯å¾„

#### 4.4 æ£€æŸ¥ Apache é…ç½® 

```shell
sudo apachectl configtest
```

å¦‚æœå®ƒæç¤ºï¼š` Syntax OK `ï¼Œé‚£å°±å®Œæˆ90%äº†ï¼Œå¦‚æœå®ƒæç¤ºæœ‰é”™ï¼Œé‚£å°±è¦æ ¹æ®é”™è¯¯æç¤ºè‡ªè¡Œè§£å†³äº†ã€‚

æˆ‘åœ¨è¿™ä¸ªç¯èŠ‚é‡åˆ°äº†ä¸€ä¸ªé”™è¯¯

```text
SSLSessionCache: 'shmcb' session cachenot supported 
(known names: ). Maybe you need toload the appropriate
socache module (mod_socache_shmcb?).
```

è§£å†³åŠæ³•å¦‚ä¸‹ï¼š

```shell
sudo vim /private/etc/apache2/httpd.conf
```

ç„¶åæŠŠä»¥ä¸‹ä»£ç çš„æ³¨é‡Šå»æ‰

```text
LoadModule socache_shmcb_module libexec/apache2/mod_socache_shmcb.so
```

å»æ‰æ³¨é‡Šåï¼Œä¿å­˜ï¼Œé‡æ–°æ£€æŸ¥é…ç½®ï¼Œç›´åˆ°æˆåŠŸã€‚

æ³¨æ„ï¼š
ä»ç½‘ä¸ŠæŸ¥æ‰¾çš„è·¯å¾„å¯èƒ½æ˜¯` LoadModule socache_shmcb_module modules/mod_socache_shmcb.so `ï¼Œ
ä½†æˆ‘çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œè·¯å¾„è·Ÿä¸Šè¿°çš„ä¸ä¸€è‡´ï¼Œä½†ç»“å°¾éƒ½æ˜¯` mod_socache_shmcb.so `å°±å¯¹äº†ã€‚

è§£å†³æ–¹æ¡ˆæ˜¯å‚è€ƒè¿™ç¯‡æ–‡ç« çš„[stackoverflowé—®ç­”](http://stackoverflow.com/questions/20127138/apache-2-4-configuration-for-ssl-not-working)ã€‚

é‡å¯ Apache æœåŠ¡` sudo apachectl -k restart `ï¼Œ
è¿™æ ·å°±å¯ä»¥ç”¨ https è®¿é—®æœ¬åœ°æœåŠ¡å™¨äº†ã€‚

## <a id="5_0"></a>ç¬¬äº”æ­¥ æ”¾ç½®èµ„æºæ–‡ä»¶

#### 5.1 ç½‘ç«™èµ„æºæ–‡ä»¶

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨` /Users/lf/web `æ–‡ä»¶å¤¹ä¸‹æ”¾ç½®çš„èµ„æºå¦‚ä¸‹ï¼š

![èµ„æºæ–‡ä»¶å¤¹](https://raw.githubusercontent.com/muzipiao/GitHubImages/master/ota/ota5.1.png)

æ–‡ä»¶å¤¹åç§°å¯ä»»æ„å–ï¼Œåªè¦åœ¨ index.html å’Œ plist æ–‡ä»¶å¤¹ä¸­è·¯å¾„å¯¹åº”å³å¯ã€‚index.html ä¸è¦æ”¹åå­—ï¼Œé»˜è®¤ã€‚

- ca.crt  CAè¯ä¹¦ï¼Œå°†` /private/etc/apache2/ssl/ca.crt `æ‹·è´ä¸€ä»½åˆ°å½“å‰ web æ–‡ä»¶å¤¹ä¸‹
- ipa æ–‡ä»¶å¤¹ï¼Œæ”¾ç½® ipa èµ„æºåŒ…
- plist æ–‡ä»¶å¤¹ï¼Œæ”¾ç½® plist æ–‡ä»¶
- index.html ç´¢å¼•ç½‘é¡µï¼Œæ”¾ç½®é“¾æ¥ä¸‹è½½å®‰è£…è¯ä¹¦å’Œipa
- images æ–‡ä»¶å¤¹ï¼ŒæŒ‰ç…§ Xcode è¦æ±‚æ”¾ç½®ä¸€ä¸ª 57Ã—57 å’Œ 512Ã—512 çš„ png å›¾ç‰‡ï¼Œè¿˜æ²¡å‘ç°ä»€ä¹ˆç”¨é€”ã€‚

#### 5.2 æ”¾ç½® ipa åŒ…
APP æ‰“åŒ…ï¼Œå¯¼å‡º ipa åŒ…å°±æ²¡å¿…è¦å¤šè¯´äº†ï¼Œå¯ä»¥å¯¼å‡º Ad Hoc æˆ–è€… Development çš„ ipa åŒ…ï¼Œå°† ipa æ”¾åœ¨æ”¾åœ¨ web æ–‡ä»¶å¤¹ä¸‹ ipa æ–‡ä»¶å¤¹ä¸­ã€‚

#### 5.3 æ”¾ç½®plistæ–‡ä»¶

æƒ³åœ¨çº¿å®‰è£…ï¼Œè¿˜éœ€è¦ä¸€ä¸ª plist æ–‡ä»¶ï¼Œæ¯ä¸ª ipa åŒ…å¯¹åº”ä¸€ä¸ª plist æ–‡ä»¶ï¼Œå°†` https://192.168.1.188/ipa/LFDev_4.2.1.ipa `æ›´æ”¹ä¸ºç”Ÿæˆè¯ä¹¦æ—¶çš„ ip æˆ–è€…åŸŸåï¼Œç„¶åå¯¹åº” ipa æ–‡ä»¶è·¯å¾„å³å¯ï¼Œä¾‹å¦‚è¿™é‡Œçš„è·¯ç»æ˜¯ï¼Œåœ¨å½“å‰ web æ–‡ä»¶å¤¹ä¸‹çš„ ipa æ–‡ä»¶å¤¹ä¸­ï¼Œåç§°ä¸º LFDev_4.2.1.ipa çš„ ipa æ–‡ä»¶ã€‚

plist æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
<key>items</key>
<array>
<dict>
<key>assets</key>
<array>
<dict>
<key>kind</key>
<string>software-package</string>
<key>url</key>
<string>https://192.168.1.188/ipa/LFDev_4.2.1.ipa</string>
</dict>
<dict>
<key>kind</key>
<string>display-image</string>
<key>url</key>
<string>https://192.168.1.188/images/image_57Ã—57.png</string>
</dict>
<dict>
<key>kind</key>
<string>full-size-image</string>
<key>url</key>
<string>https://192.168.1.188/images/image_512Ã—512.png</string>
</dict>
</array>
<key>metadata</key>
<dict>
<key>bundle-identifier</key>
<string>com.xxx.yyy</string>
<key>bundle-version</key>
<string>4.2.0</string>
<key>kind</key>
<string>software</string>
<key>title</key>
<string>Cxx</string>
</dict>
</dict>
</array>
</dict>
</plist>
```

- bundle-identifierçš„å€¼com.xxx.yyyæ›´æ”¹ä¸ºä½ åº”ç”¨çš„Bundle ID
- bundle-versionçš„å€¼4.2.0æ›´æ”¹ä¸ºä½ åº”ç”¨çš„ç‰ˆæœ¬version
- titleçš„å€¼Cxxæ›´æ”¹ä¸ºä½ åº”ç”¨çš„åç§°ï¼Œä¸‹è½½æ—¶ä¼šå¼¹å‡ºå®‰è£…æç¤ºæ­¤åç§°

#### 5.4 åˆ›å»ºç´¢å¼•ä¸‹è½½ç½‘é¡µ index.html

åœ¨` /Users/lf/web `æ–‡ä»¶å¤¹ä¸‹è¿˜éœ€è¦ä¸€ä¸ª index.html æ–‡ä»¶ï¼Œ
æ‰‹æœºé¦–æ¬¡ä½¿ç”¨ OTA å®‰è£…ï¼Œå¿…é¡»å…ˆä¸‹è½½å®‰è£… ca.crt è¯ä¹¦ï¼Œç„¶åå†ç‚¹å‡»å®‰è£… ipaã€‚
url ä¸­å¿…é¡»å¡«å†™ https å¼€å¤´çš„ plist æ–‡ä»¶ä¸‹è½½åœ°å€ï¼Œplist æ–‡ä»¶ä¸­å¯¹åº” ipa æ–‡ä»¶çš„ä¸‹è½½åœ°å€ã€‚

```html
<html>
<head>
<meta name="viewport"content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes"/>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
<h4>æ‰‹æœºé¦–æ¬¡ä¸‹è½½è¯·å…ˆ"ç‚¹å‡»å®‰è£…SSLè¯ä¹¦"ï¼Œå¹¶æ ¹æ®æç¤ºå®‰è£…ä¿¡ä»»è¯ä¹¦</h4>
åœ¨ iOS 10.3 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œæ‰‹åŠ¨å®‰è£…åŒ…å«è¯ä¹¦æœ‰æ•ˆè´Ÿè½½çš„æè¿°æ–‡ä»¶æ—¶ï¼Œè¿™ä¸ªè¯ä¹¦ä¸ä¼šè‡ªåŠ¨å— SSL ä¿¡ä»»ã€‚
å½“å®‰è£…é€šè¿‡ç”µå­é‚®ä»¶å‘é€æˆ–ä»ç½‘ç«™ä¸‹è½½çš„æè¿°æ–‡ä»¶æ—¶ï¼Œæ‚¨å¿…é¡»æ‰‹åŠ¨å¼€å¯å— SSL ä¿¡ä»»ã€‚
è¦ä¸ºè¿™ä¸ªè¯ä¹¦å¼€å¯å— SSL ä¿¡ä»»ï¼Œè¯·å‰å¾€â€œè®¾ç½®â€>â€œé€šç”¨â€>â€œå…³äºæœ¬æœºâ€>â€œè¯ä¹¦ä¿¡ä»»è®¾ç½®â€ã€‚åœ¨â€œé’ˆå¯¹æ ¹è¯ä¹¦å¯ç”¨å®Œå…¨ä¿¡ä»»â€ä¸‹ï¼Œå¼€å¯ä¿¡ä»»è¿™ä¸ªè¯ä¹¦ã€‚
<a title="iPhone" href="https://192.168.1.188/ca.crt">ğŸ‘‰ç‚¹å‡»å®‰è£…SSLè¯ä¹¦ğŸ‘ˆ</a>
<hr>
<a href="itms-services://?action=download-manifest&url=https://192.168.1.188/plist/LFAdHoc_4.2.0.plist" class="app_link">ğŸ‘‰ç‚¹å‡»å®‰è£…4.2.0ç”Ÿäº§ç‰ˆæœ¬ğŸ‘ˆ</a>
<hr>
<a href="itms-services://?action=download-manifest&url=https://192.168.1.188/plist/LFDev_4.2.1.plist" class="app_link">ğŸ‘‰ç‚¹å‡»å®‰è£…4.2.1å¼€å‘ç‰ˆæœ¬ğŸ‘ˆ</a>
<hr>
<a href="itms-services://?action=download-manifest&url=https://192.168.1.188/plist/LFVali_4.2.1.plist" class="app_link">ğŸ‘‰ç‚¹å‡»å®‰è£…4.2.1éªŒè¯ç‰ˆæœ¬ğŸ‘ˆ</a>
<hr>
</body>
</html>
```

å¦‚æœæ˜¯æƒ³ ipa æ”¾åœ¨å±€åŸŸç½‘ç”µè„‘ä¸Šé¢ï¼Œåˆ™å°†å½“åšæ‰“åŒ…æœåŠ¡å™¨çš„ç”µè„‘ ip æ‰‹åŠ¨è®¾ç½®å›ºå®š ipï¼š192.168.1.188ï¼Œç„¶åæ‰‹æœºå’Œç”µè„‘è¿æ¥åŒä¸€ä¸ªè·¯ç”±å™¨ï¼Œiphone çš„ Safari æµè§ˆå™¨ä¸­è¾“å…¥ 192.168.1.188 æˆ–è€… 192.168.1.188/index.html å³å¯ï¼Œç‚¹å‡»å®‰è£… SSL è¯ä¹¦ï¼Œç„¶åç‚¹å‡»å®‰è£… ipa åŒ…ã€‚

#### 5.5 iOS 10.3 åå¿…é¡»è®¾ç½®è¯ä¹¦ä¿¡ä»»

å¦‚æœä¸‹è½½ ipa æ—¶å‡ºç°æ— æ³•è¿æ¥åˆ°` 192.168.*.* `çš„é”™è¯¯ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨è®¾ç½®ä¿¡ä»»ã€‚

iOS7.0 ä»¥åå¿…é¡»ä½¿ç”¨ HTTPS è¿›è¡Œï¼ŒiOS 10 ä¹‹å‰çš„è®¾å¤‡ï¼Œç›´æ¥å®‰è£…è‡ªç­¾åæ ¹è¯ä¹¦åå°±å¯ä»¥å®‰è£… iOS åº”ç”¨ï¼Œä½†æ˜¯åœ¨ iOS 10.3 ä»¥ä¸Šçš„è®¾å¤‡ä¸Šï¼Œå®‰è£…åè¿˜éœ€è¦åˆ°â€œå…³äºæœ¬æœºâ€é‚£é‡Œæ‰‹åŠ¨å¼€å¯ä¿¡ä»»ã€‚

è‹¹æœå®˜ç½‘æç¤ºï¼Œåœ¨ iOS ä¸­ä¿¡ä»»æ‰‹åŠ¨å®‰è£…çš„è¯ä¹¦æè¿°æ–‡ä»¶ [https://support.apple.com/zh-cn/HT204477](https://support.apple.com/zh-cn/HT204477)

> åœ¨ iOS 10.3 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œæ‰‹åŠ¨å®‰è£…åŒ…å«è¯ä¹¦æœ‰æ•ˆè´Ÿè½½çš„æè¿°æ–‡ä»¶æ—¶ï¼Œ
> è¿™ä¸ªè¯ä¹¦ä¸ä¼šè‡ªåŠ¨å— SSL ä¿¡ä»»ã€‚
> å½“å®‰è£…é€šè¿‡ç”µå­é‚®ä»¶å‘é€æˆ–ä»ç½‘ç«™ä¸‹è½½çš„æè¿°æ–‡ä»¶æ—¶ï¼Œ
> æ‚¨å¿…é¡»æ‰‹åŠ¨å¼€å¯å— SSL ä¿¡ä»»ã€‚
> è¦ä¸ºè¿™ä¸ªè¯ä¹¦å¼€å¯å— SSL ä¿¡ä»»ï¼Œ
> è¯·å‰å¾€â€œè®¾ç½®â€>â€œé€šç”¨â€>â€œå…³äºæœ¬æœºâ€>â€œè¯ä¹¦ä¿¡ä»»è®¾ç½®â€ã€‚
> åœ¨â€œé’ˆå¯¹æ ¹è¯ä¹¦å¯ç”¨å®Œå…¨ä¿¡ä»»â€ä¸‹ï¼Œå¼€å¯ä¿¡ä»»è¿™ä¸ªè¯ä¹¦ã€‚

## <a id="6_0"></a>å‚è€ƒé“¾æ¥

`http://stackoverflow.com/questions/20127138/apache-2-4-configuration-for-ssl-not-working`
