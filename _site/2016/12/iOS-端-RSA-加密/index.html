<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>iOS 端 RSA 加密</title>
  <meta name="description" content="RSA算法是最广为使用的“非对称加密算法”，基本上只要有计算机网络的地方，就有RSA算法。这种算法非常可靠，密钥越长，它就越难破解。根据报道，目前被破解的最长RSA密钥是768个二进制位。也就是说，长度超过768位的密钥，还无法破解(至少没人公开宣布)。 因此可以认为，1024位的RSA密钥基本安全，2048位的...">
  <meta name="author" content="leopardpan">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="iOS 端 RSA 加密">
  <meta name="twitter:description" content="RSA算法是最广为使用的“非对称加密算法”，基本上只要有计算机网络的地方，就有RSA算法。这种算法非常可靠，密钥越长，它就越难破解。根据报道，目前被破解的最长RSA密钥是768个二进制位。也就是说，长度超过768位的密钥，还无法破解(至少没人公开宣布)。 因此可以认为，1024位的RSA密钥基本安全，2048位的...">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="iOS 端 RSA 加密">
  <meta property="og:description" content="RSA算法是最广为使用的“非对称加密算法”，基本上只要有计算机网络的地方，就有RSA算法。这种算法非常可靠，密钥越长，它就越难破解。根据报道，目前被破解的最长RSA密钥是768个二进制位。也就是说，长度超过768位的密钥，还无法破解(至少没人公开宣布)。 因此可以认为，1024位的RSA密钥基本安全，2048位的...">
  
  <link rel="icon" type="image/png" href="/images/favicon.png" />
  <link href="/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//libs.baidu.com/fontawesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2016/12/iOS-%E7%AB%AF-RSA-%E5%8A%A0%E5%AF%86/">
  <link rel="alternate" type="application/rss+xml" title="cocoafei" href="http://localhost:4000/feed.xml">

<!-- 百度统计 -->
  

<!-- google 统计 -->
  

</head>


  <body>

    <span class="mobile btn-mobile-menu">        
      <div class="nav_container">
         <nav class="nav-menu-item" style = "float:right">
            <i class="nav-menu-item">
              <a href="/#blog" title="" class="blog-button">  博客主页
              </a>
            </i>
            
                <i class="nav-menu-item">

                  <a href="/archive" title="archive" class="btn-mobile-menu__icon">
                      所有文章
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/tags" title="tags" class="btn-mobile-menu__icon">
                      标签
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/about" title="about" class="btn-mobile-menu__icon">
                      关于我
                  </a>
                </i>
            
          </nav>
      </div>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/images/background-cover.png')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <!-- 头像效果-start -->
        <div class="ih-item circle effect right_to_left">            
            <a href="/#blog" title="前往 cocoafei 的主页" class="blog-button">
                <div class="img"><img src="/images/avatar.jpg" alt="img"></div>
                <div class="info">
                    <div class="info-back">
                        <h2> 
                            
                                cocoafei
                            
                        </h2>
                        <p>
                           
                                iOS / Python
                            
                        </p>
                    </div>
                </div>
            </a>
        </div>
        <!-- 头像效果-end -->
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for cocoafei" class="blog-button">cocoafei</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">个人站</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">欢迎来到我的Blog~</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        

        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">博客主页</a></li>
                
                  <li class="navigation__item"><a href="/archive" title="archive">所有文章</a></li>
                
                  <li class="navigation__item"><a href="/tags" title="tags">标签</a></li>
                
                  <li class="navigation__item"><a href="/about" title="about">关于我</a></li>
                
              </ul>
            </nav>
          </div>          
        </div>


        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-clear"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title">iOS 端 RSA 加密</h1>
    <div class="post-meta">
      <img src="/images/calendar.png" width="20px" style="vertical-align:middle;"/> 
      <time datetime="2016-12-11 00:00:00 +0800" itemprop="datePublished" class="post-meta__date date" style="vertical-align:middle;">2016-12-11</time>
    </p>  
    </div>
  </header>

  <section class="post">
    <p><strong><code class="language-plaintext highlighter-rouge">RSA算法</code>是最广为使用的“<code class="language-plaintext highlighter-rouge">非对称加密算法</code>”，基本上只要有计算机网络的地方，就有RSA算法。</strong>
这种算法非常可靠，密钥越长，它就越难破解。根据报道，目前被破解的最长RSA密钥是768个二进制位。也就是说，长度超过768位的密钥，还无法破解(至少没人公开宣布)。 因此可以认为，1024位的RSA密钥基本安全，2048位的密钥极其安全。RSA是由Rivest、Shamir 和 Adleman三位数学家1977年提出的加密算法，所以以他们首字母命名。</p>

<h2 id="理解rsa">理解RSA</h2>

<p><strong>理解<code class="language-plaintext highlighter-rouge">RSA</code>首先要理解<code class="language-plaintext highlighter-rouge">非对称加密</code>:</strong></p>

<ul>
  <li><strong>公私钥：</strong> 非对称加密有<code class="language-plaintext highlighter-rouge">公钥</code>和<code class="language-plaintext highlighter-rouge">私钥</code>组成，公钥和私钥是按照一定数学算法生成的。公钥是公开的，任何人都可以获取。私钥是保密的，只有拥有者才能使用。</li>
  <li><strong>加密和签名：</strong> 他人使用你的公钥加密信息，然后发送给你，你用私钥解密，取出信息。反过来，你也可以用私钥加密信息，别人用你的公钥解开，从而证明这个信息确实是你发出的，且未被篡改，这叫做数字签名。</li>
  <li><strong>理解：</strong> 至于公钥和私钥的关系，有人形象的把公钥比喻为保险箱，把私钥比喻为保险箱的钥匙，保险箱我可以给任何人，也可以有多个保险箱，任何人都可以往保险箱里面放东西(机密数据)，但只有我有私钥(保险箱的钥匙)，只有我能打开保险箱。</li>
</ul>

<h2 id="ios使用rsa">iOS使用RSA</h2>

<p><strong>RSA加密</strong>在<code class="language-plaintext highlighter-rouge">iOS</code>中经常用到，常见场景是<strong>加密用户输入的密码</strong>发送给后台，当然为了不<strong>泄露用户密码</strong>，一般都是将密码进行<strong>MD5加盐编码</strong>后再用RSA加密给后台，这样即使<strong>被破解</strong>，也不会泄露用户输入的密码。</p>

<h3 id="基本流程">基本流程</h3>

<pre><code class="language-sequence">客户端-&gt;&gt;服务器: App请求“公钥”
服务器-&gt;&gt;客户端: Server返回“公钥”
客户端-&gt;&gt;服务器: App用公钥加密“密码”发送
服务器-&gt;&gt;客户端: Server解密正确返回数据
</code></pre>

<blockquote>
  <p><strong>注意：</strong> 一般是后台从<strong>密钥池</strong>中选取一对公私钥，把公钥发送给客户端，客户端加密密码等<strong>机密信息</strong>后发送给后台，后台使用<strong>私钥解密</strong>获取加密的内容。</p>
</blockquote>

<h3 id="ios使用rsa注意点">iOS使用RSA注意点</h3>

<ul>
  <li><strong>防反编译：</strong> 密码密钥等信息一般不存在客户端，防止被<strong>反编译</strong>。</li>
  <li><strong>耗时操作：</strong> 生成公私钥是<strong>耗时操作</strong>，后台一般会提前生成多对公私钥保存到数据库中，使用的时候随机取出一对，使用并记录使用的那一对即可。</li>
  <li><strong>文件格式：</strong> 后台生成.der和.p12后缀格式的文件，其中<strong>der格式</strong>的文件存放的是公钥（Public key）用于加密，<strong>p12格式</strong>的文件存放的是私钥（Private key）用于解密。后台可以从.der文件中读出公钥，转化为JSON字符串格式发送给客户端，也可以直接发送后缀名为.der格式公钥文件，客户端下载后使用。</li>
  <li>
    <p><strong>iOS生成公私钥对：</strong> 至于iOS端生成RSA公私钥，需要集成<strong>openssl库</strong>，具体Google百度吧。</p>
  </li>
  <li><strong>加解密失败：</strong> 
如果与后台联调的时候加解密失败，注意一下<strong>密钥格式</strong>(分为pkcs8和pkcs1)。例如Mac下生成的给iOS使用公私钥文件.der和.p12，密钥编码格式为pkcs1；而Java后台使用的.pem文件格式的公私钥，编码格式为pkcs8，使用的时候需要转换格式。</li>
</ul>

<h2 id="rsa可靠性">RSA可靠性</h2>

<blockquote>
  <p><strong>Wiki百科：</strong> 对极大整数做因数分解的难度决定了RSA算法的可靠性。换言之，对一极大整数做因数分解愈困难，RSA算法愈可靠。</p>

  <p>假如有人找到一种快速因数分解的算法，那么RSA的可靠性就会极度下降。但找到这样的算法的可能性是非常小的。今天只有短的RSA密钥才可能被暴力破解。到目前为止，世界上还没有任何可靠的攻击RSA算法的方式。</p>

  <p>只要密钥长度足够长，用RSA加密的信息实际上是不能被解破的。</p>
</blockquote>

<h3 id="rsa公私钥生成步骤">RSA公私钥生成步骤：</h3>

<ol>
  <li>随意选择两个大的质数p和q，p不等于q，计算N=pq，N的二进制位数就是密钥长度。</li>
  <li>根据欧拉函数(对正整数n，欧拉函数是小于n的正整数中与n互质的数的数目)，求得r = (p-1)(q-1)</li>
  <li>选择一个小于r的整数e，条件是1&lt; e &lt; r，且e与r互质，求得 e 关于模 r 的模反元素，命名为d。（模反元素存在，当且仅当e与r互质）</li>
  <li>将 p 和 q 的记录销毁。</li>
  <li>(N,e)是公钥，(N,d)是私钥。</li>
</ol>

<h3 id="rsa加解密公式">RSA加解密公式</h3>

<blockquote>
  <p>PS:假设m为要传递的密文,mod为求余，N、e、d都是已知的</p>
</blockquote>

<ul>
  <li><strong>加密公式：</strong> m^e ≡ c (mod N)，m、e、N都为已知，加密就是算出密文c。</li>
  <li><strong>解密公式：</strong> c^d ≡ m (mod N)，c、d、N为已知，解密就是算出m。</li>
</ul>

<h3 id="rsa加密长度限制">RSA加密长度限制：</h3>

<ul>
  <li><strong>理论可加密明文长度：</strong> RSA算法本身要求加密内容也就是<strong>明文长度m</strong>必须0&lt;m&lt;N，也就是说内容这个大整数不能超过N，否则就出错。</li>
  <li><strong>实际可加密明文长度：</strong> 实际可加密明文长度小于理论长度，因为加密需要遵循一定标准，需要用到padding，padding标准有NoPPadding、OAEPPadding、PKCS1Padding，其中PKCS#1建议的padding就占用了11个字节。</li>
  <li><strong>实际可加密明文长度计算：</strong> 目前主流的密钥长度一般为<strong>1024bits</strong>和<strong>2048bits</strong>，如果是PKCS格式密钥长度是1024位，则可加密字符长度为1024/8=128个字节，实际可加密明文长度为128-11=117个字节；同理，如果是PKCS格式2048位密钥，可加密长度为256-11=244个字节。</li>
</ul>

<h3 id="rsa加密长度超限制解决办法">RSA加密长度超限制解决办法：</h3>

<p><strong>如果要加密大于N的数据怎么办？</strong> 有两种解决方法：</p>
<ul>
  <li>一种是把<strong>长信息分割</strong>成若干段短消息，每段分别加密，因为RSA加解密效率比较低，所以这种方式效率很低；</li>
  <li>另一种是先选择一种”<strong>对称性加密算法</strong>“（比如DES或AES），先用RSA加密传递DES或AES密钥，然后用AES或DES的密钥加密信息，对称加密的效率很高。HTTPS就是采用这种方式，RSA传递对称加密密钥，对称密钥加密数据传递。</li>
</ul>

<h2 id="ios端rsa加解密示例">iOS端RSA加解密示例</h2>

<h3 id="场景客户端加密用户密码交易密码发送给服务器">场景：客户端加密<code class="language-plaintext highlighter-rouge">用户密码/交易密码</code>发送给服务器</h3>

<blockquote>
  <p>客户端向服务器请求<code class="language-plaintext highlighter-rouge">RSA公钥</code> → <code class="language-plaintext highlighter-rouge">服务器</code> → 返给客户端一个<code class="language-plaintext highlighter-rouge">NSString</code>格式的RSA公钥 → 客户端用<code class="language-plaintext highlighter-rouge">RSA公钥字符串</code>加密<code class="language-plaintext highlighter-rouge">密码</code>发送给服务器 → 服务器用RSA私钥解密并核对<code class="language-plaintext highlighter-rouge">密码</code> → 核对密码是否正确，并返回客户数据给客户端</p>
</blockquote>

<p><img src="/images/posts/rsa/RSAImg2.png" alt="RSA序列图" /></p>

<h4 id="例如这是一串服务器生成的rsa公钥">例如：这是一串服务器生成的RSA公钥</h4>

<blockquote>
  <p>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDTbZ6cNH9
PgdF60aQKveLz3FTalyzHQwbp601y77SzmGHX3F5NoVUZbd
K7UMdoCLK4FBziTewYD9DWvAErXZo9BFuI96bAop8wfl1Vk
ZyyHTcznxNJFGSQd/B70/ExMgMBpEwkAAdyUqIjIdVGh1FQ
K/4acwS39YXwbS+IlHsPSQIDAQAB</p>

</blockquote>

<p>但由于含有<code class="language-plaintext highlighter-rouge">/+=\n</code>等特殊字符串，网络传输过程中导致转义，进而导致加密解密不成功，解决办法是进行URL特殊符号编码解码(百分号转义)；具体示例，在Demo中有示例，文章最下方有<a href="https://github.com/muzipiao/RSAEncrypt">Demo链接</a>。</p>

<h4 id="rsa用nsstring加密解密demo非常简单">RSA用NSString加密解密Demo，非常简单</h4>

<pre><code class="language-Objective-C">//----------------------RSA加密示例------------------------
//原始数据，要加密的字符串
NSString *originalString = @"这是一段将要使用'秘钥字符串'进行加密的字符串!";

//使用字符串格式的公钥私钥加密解密, RSAPublickKey为公钥字符串(NSString格式)
NSString *encryptStr = [RSAEncryptor encryptString:originalString publicKey:RSAPublickKey];

NSLog(@"加密前:%@", originalString);
NSLog(@"加密后:%@", encryptStr);
//用私钥解密，RSAPrivateKey为私钥字符串(NSString格式)
NSString *decryptString = [RSAEncryptor decryptString:encryptStr privateKey:RSAPrivateKey];

NSLog(@"解密后:%@",decryptString);
</code></pre>

<h4 id="rsa用nsstring加解密的示例头文件">RSA用NSString加解密的示例头文件</h4>

<pre><code class="language-Objective-C">// RSA加密封装类
//注意：如果使用，需要打开钥匙串；因为iOS不支持直接使用字符串格式的公钥进行加密，转换为文件后可使用

#import &lt;Foundation/Foundation.h&gt;

@interface RSAEncryptor : NSObject

/**
*  加密方法
*
*  @param str   需要加密的字符串
*  @param path  '.der'格式的公钥文件路径
*/
+ (NSString *)encryptString:(NSString *)str publicKeyWithContentsOfFile:(NSString *)path;

/**
*  解密方法
*
*  @param str       需要解密的字符串
*  @param path      '.p12'格式的私钥文件路径
*  @param password  私钥文件密码
*/
+ (NSString *)decryptString:(NSString *)str privateKeyWithContentsOfFile:(NSString *)path password:(NSString *)password;

/**
*  加密方法
*
*  @param str    需要加密的字符串
*  @param pubKey 公钥字符串
*/
+ (NSString *)encryptString:(NSString *)str publicKey:(NSString *)pubKey;

/**
*  解密方法
*
*  @param str     需要解密的字符串
*  @param privKey 私钥字符串
*/
+ (NSString *)decryptString:(NSString *)str privateKey:(NSString *)privKey;

@end
</code></pre>

<p>如果您觉得有所帮助，请在<a href="https://github.com/muzipiao/RSAEncrypt">RSADemo</a>上赏个Star ⭐️，您的鼓励是我前进的动力</p>

<h4 id="参考">参考：</h4>

<ul>
  <li><a href="https://blog.csdn.net/dbs1215/article/details/48953589">带你彻底理解RSA算法原理</a></li>
  <li><a href="http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html">RSA算法原理一</a></li>
  <li><a href="http://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html">RSA算法原理二</a></li>
  <li><a href="http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html">数字签名是什么</a></li>
</ul>


  </section>
</article>

<section>

    <div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';"></div>

    <ul class="pager">
        
        <li class="previous">
            <a href="/2016/10/%E6%8C%87%E7%BA%B9-%E9%9D%A2%E5%AE%B9-%E7%99%BB%E5%BD%95%E6%88%96%E6%94%AF%E4%BB%98/" data-toggle="tooltip"
                data-placement="top" title="指纹（面容）登录或支付">上一篇： <span>指纹（面容）登录或支付</span>
            </a>
        </li>
        
        
        <li class="next">
            <a href="/2017/01/Shell-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/" data-toggle="tooltip"
                data-placement="top" title="Shell 自动化打包">下一篇： <span>Shell 自动化打包</span>
            </a>
        </li>
        
    </ul>
</section>
<section class="post-comments">

</section>


            <section class="footer">
    <footer>
        <div class = "footer_div">
            <nav class="cover-navigation navigation--social">
                <ul class="navigation">
                    
                    
                    <!-- Github -->
                    <li class="navigation__item_social">
                        <a href="https://github.com/muzipiao" title="@muzipiao 的 Github" target="_blank">
                            <div class="footer-social-icon" style="background-image:url(/images/github.png);"></div>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    <!-- Zhihu -->
                    <li class="navigation__item_social">
                        <a href="https://juejin.cn/user/5b2f1c51f265da59ad439f69" title="@5b2f1c51f265da59ad439f69" target="_blank">
                            <div class="footer-social-icon" style="background-image:url(/images/juejin.png);"></div>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <!-- Email -->
                    <li class="navigation__item_social">
                        <a href="mailto:lifei_zdjl@126.com" title="Contact me">
                            <div class="footer-social-icon" style="background-image:url(/images/email.png);"></div>
                        </a>
                    </li>
                    
                    
                    <!-- RSS -->
                    <li class="navigation__item_social">
                        <a href="/feed.xml" rel="author" title="RSS" target="_blank">
                            <div class="footer-social-icon" style="background-image:url(/images/rss.png);"></div>
                            <span class="label">RSS</span>
                        </a>
                    </li>
                    
                </ul>
            </nav>
        </div>
        <div><br><br></div>
        <div class="footer__copyright" >
            <br>
            <span>©2024&nbsp;cocoafei&nbsp;</span>
        </div>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//libs.baidu.com/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



    
  </body>

</html>
