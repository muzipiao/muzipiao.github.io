<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>iOS 手机号一键登录</title>
  <meta name="description" content="什么是一键登录">
  <meta name="author" content="leopardpan">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="iOS 手机号一键登录">
  <meta name="twitter:description" content="什么是一键登录">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="iOS 手机号一键登录">
  <meta property="og:description" content="什么是一键登录">
  
  <link rel="icon" type="image/png" href="/images/favicon.png" />
  <link href="/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//libs.baidu.com/fontawesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2020/10/iOS-%E6%89%8B%E6%9C%BA%E5%8F%B7%E4%B8%80%E9%94%AE%E7%99%BB%E5%BD%95/">
  <link rel="alternate" type="application/rss+xml" title="cocoafei" href="http://localhost:4000/feed.xml">

<!-- 百度统计 -->
  

<!-- google 统计 -->
  

</head>


  <body>

    <span class="mobile btn-mobile-menu">        
      <div class="nav_container">
         <nav class="nav-menu-item" style = "float:right">
            <i class="nav-menu-item">
              <a href="/#blog" title="" class="blog-button">  博客主页
              </a>
            </i>
            
                <i class="nav-menu-item">

                  <a href="/archive" title="archive" class="btn-mobile-menu__icon">
                      所有文章
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/tags" title="tags" class="btn-mobile-menu__icon">
                      标签
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/about" title="about" class="btn-mobile-menu__icon">
                      关于我
                  </a>
                </i>
            
          </nav>
      </div>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/images/background-cover.png')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <!-- 头像效果-start -->
        <div class="ih-item circle effect right_to_left">            
            <a href="/#blog" title="前往 cocoafei 的主页" class="blog-button">
                <div class="img"><img src="/images/avatar.jpg" alt="img"></div>
                <div class="info">
                    <div class="info-back">
                        <h2> 
                            
                                cocoafei
                            
                        </h2>
                        <p>
                           
                                iOS / Python
                            
                        </p>
                    </div>
                </div>
            </a>
        </div>
        <!-- 头像效果-end -->
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for cocoafei" class="blog-button">cocoafei</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">个人站</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">欢迎来到我的Blog~</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        

        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">博客主页</a></li>
                
                  <li class="navigation__item"><a href="/archive" title="archive">所有文章</a></li>
                
                  <li class="navigation__item"><a href="/tags" title="tags">标签</a></li>
                
                  <li class="navigation__item"><a href="/about" title="about">关于我</a></li>
                
              </ul>
            </nav>
          </div>          
        </div>


        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-clear"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title">iOS 手机号一键登录</h1>
    <div class="post-meta">
      <img src="/images/calendar.png" width="20px" style="vertical-align:middle;"/> 
      <time datetime="2020-10-09 00:00:00 +0800" itemprop="datePublished" class="post-meta__date date" style="vertical-align:middle;">2020-10-09</time>
    </p>  
    </div>
  </header>

  <section class="post">
    <h2 id="什么是一键登录">什么是一键登录</h2>

<p>iOS 无法直接获取当前设备手机号码（不包含使用私有 API），但电信服务运营商（移动/联通/电信等）是知道流量哪张手机卡消耗的，结合运营商的网关认证能力，就可以识别出当前使用的手机卡号码。通常说的场景是指<strong>一键登录</strong>和<strong>本机号码认证</strong>两个不同的功能，使用场景不一样，无需一起使用。</p>

<p><strong>一键登录使用场景</strong>：用户无需输入手机号码，SDK 会拉起授权页，用户确认授权后，SDK 会获取 token，服务端携带 token 到运营商网关获取用户当前上网使用的号码（eg. 服务端调用 GetMobile 接口），并返回给 App 服务端，服务端可将当前用户置为登录状态，并把手机号返回客户端。</p>

<p><strong>本机号码认证使用场景</strong>：用户输入手机号码，通过 SDK 获取 token，服务端携带输入的手机号码和 token 去运营商网关进行校验（eg. 服务端调用 VerifyMobile 接口），返回的结果是用户当前上网使用的号码与输入的号码是否一致。</p>

<p><strong>注意</strong>：</p>

<ul>
  <li>token 由集成的 SDK 生成，例如集成的是移动认证 SDK，则调用对应 API 返回 token；</li>
  <li>用户必须开启 4G 流量，如果是多卡手机，则只能认证当前使用的流量的手机卡，2G/3G 影响识别效果；</li>
  <li>手机号一键登录功能不支持任意应用，待使用的 APP 必须在管理平台配置对应的 APP 包名和唯一标识（Android为签名，iOS 为 Bundle ID）。</li>
</ul>

<h2 id="运营商">运营商</h2>

<p><strong>电信运营商都公布自己的开放平台和 SDK：</strong></p>

<ul>
  <li>移动 - 互联网能力开放平台（http://dev.10086.cn/numIdentific?from=index）</li>
  <li>电信 - 天翼账号开放平台（http://id.189.cn/banner/unPassword）</li>
  <li>联通 - WO+ 开放平台（http://www.open.wo.com.cn/aep/index.html）</li>
</ul>

<p><strong>三方运营商：</strong></p>

<p>三方运营商一般会整合了三大运营商的网关认证能力，其实就是在三大运营商 SDK 基础上进行了封装。</p>

<ul>
  <li>极光认证（https://www.jiguang.cn/identify）</li>
  <li>友盟认证（https://market.aliyun.com/products/57124001/cmapi00036707.html）</li>
  <li>网易认证（https://dun.163.com/product/phone-verification）</li>
</ul>

<p>集成测试对比，移动、极光和友盟，文档较齐全，移动 SDK 与项目冲突概率较小，极光和友盟可能需要项目已集成的对应 SDK 基础库版本，友盟还可能会与其他阿里组件冲突。</p>

<h2 id="一键登录流程">一键登录流程</h2>

<p>一键登录与本机号码认证流程很类似，用户使用体验的区别，可简单归纳为是否输入手机号码。一键登录流程如下：</p>

<ol>
  <li>SDK 初始化：调用 SDK 的初始化方法，传入项目在平台上的 AppKey 和 AppSecret；</li>
  <li>唤起授权页：调用 SDK 唤起授权接口。SDK 会先向运营商发起获取手机号掩码的请求，请求成功后跳转到授权页。授权页会显示手机号掩码以及运营商协议给用户确认；</li>
  <li>同意授权并登录：用户同意相关协议，点击授权页面的登录按钮，SDK 会请求本次取号的 token，请求成功后将 token 返回给客户端；</li>
  <li>取号：将获取到的 token 发送到我们自己的服务器，由服务器携带 token 调用运营商一键登录的接口，调用成功就返回手机号码了。服务器用手机号进行登录或注册操作，返回操作结果给客户端，完成一键登录。</li>
</ol>

<p>流程图如下：</p>

<p><img src="/images/posts/phone_oauth/phone_oauth0.png" alt="一键登录流程" /></p>

<p>一键登录授权页面大致如下：</p>

<p><img src="/images/posts/phone_oauth/phone_oauth1.png" alt="一键登录授权" /></p>


  </section>
</article>

<section>

    <div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';"></div>

    <ul class="pager">
        
        <li class="previous">
            <a href="/2020/08/%E5%BC%80%E5%8F%91%E8%80%85%E5%BF%AB%E9%80%9F%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E6%8C%87%E5%8D%97/" data-toggle="tooltip"
                data-placement="top" title="开发者快速配置环境指南">上一篇： <span>开发者快速配置环境指南</span>
            </a>
        </li>
        
        
        <li class="next">
            <a href="/2020/12/GitHub-Actions-%E7%9B%91%E6%B5%8B%E7%BD%91%E7%AB%99%E5%9C%A8%E7%BA%BF/" data-toggle="tooltip"
                data-placement="top" title="GitHub Actions 监测网站在线">下一篇： <span>GitHub Actions 监测网站在线</span>
            </a>
        </li>
        
    </ul>
</section>
<section class="post-comments">

</section>


            <section class="footer">
    <footer>
        <div class = "footer_div">
            <nav class="cover-navigation navigation--social">
                <ul class="navigation">
                    
                    
                    <!-- Github -->
                    <li class="navigation__item_social">
                        <a href="https://github.com/muzipiao" title="@muzipiao 的 Github" target="_blank">
                            <div class="footer-social-icon" style="background-image:url(/images/github.png);"></div>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    <!-- Zhihu -->
                    <li class="navigation__item_social">
                        <a href="https://juejin.cn/user/5b2f1c51f265da59ad439f69" title="@5b2f1c51f265da59ad439f69" target="_blank">
                            <div class="footer-social-icon" style="background-image:url(/images/juejin.png);"></div>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <!-- Email -->
                    <li class="navigation__item_social">
                        <a href="mailto:lifei_zdjl@126.com" title="Contact me">
                            <div class="footer-social-icon" style="background-image:url(/images/email.png);"></div>
                        </a>
                    </li>
                    
                    
                    <!-- RSS -->
                    <li class="navigation__item_social">
                        <a href="/feed.xml" rel="author" title="RSS" target="_blank">
                            <div class="footer-social-icon" style="background-image:url(/images/rss.png);"></div>
                            <span class="label">RSS</span>
                        </a>
                    </li>
                    
                </ul>
            </nav>
        </div>
        <div><br><br></div>
        <div class="footer__copyright" >
            <br>
            <span>©2024&nbsp;cocoafei&nbsp;</span>
        </div>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//libs.baidu.com/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



    
  </body>

</html>
