<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>自建局域网 OTA 服务器</title>
  <meta name="description" content="  第一步 编辑前的准备  第二步 配置Http服务  第三步 生成自签名证书  第四步 配置HTTPS服务  第五步 放置资源文件  参考链接">
  <meta name="author" content="leopardpan">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="自建局域网 OTA 服务器">
  <meta name="twitter:description" content="  第一步 编辑前的准备  第二步 配置Http服务  第三步 生成自签名证书  第四步 配置HTTPS服务  第五步 放置资源文件  参考链接">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="自建局域网 OTA 服务器">
  <meta property="og:description" content="  第一步 编辑前的准备  第二步 配置Http服务  第三步 生成自签名证书  第四步 配置HTTPS服务  第五步 放置资源文件  参考链接">
  
  <link rel="icon" type="image/png" href="/images/favicon.png" />
  <link href="/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//libs.baidu.com/fontawesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="https://cocoafei.top/2018/11/%E8%87%AA%E5%BB%BA%E5%B1%80%E5%9F%9F%E7%BD%91-OTA-%E6%9C%8D%E5%8A%A1%E5%99%A8/">
  <link rel="alternate" type="application/rss+xml" title="cocoafei" href="https://cocoafei.top/feed.xml">

<!-- 百度统计 -->
  

<!-- google 统计 -->
  

</head>


  <body>

    <span class="mobile btn-mobile-menu">        
      <div class="nav_container">
         <nav class="nav-menu-item" style = "float:right">
            <i class="nav-menu-item">
              <a href="/#blog" title="" class="blog-button">  博客主页
              </a>
            </i>
            
                <i class="nav-menu-item">

                  <a href="/archive" title="archive" class="btn-mobile-menu__icon">
                      所有文章
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/tags" title="tags" class="btn-mobile-menu__icon">
                      标签
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/about" title="about" class="btn-mobile-menu__icon">
                      关于我
                  </a>
                </i>
            
          </nav>
      </div>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/images/background-cover.png')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <!-- 头像效果-start -->
        <div class="ih-item circle effect right_to_left">            
            <a href="/#blog" title="前往 cocoafei 的主页" class="blog-button">
                <div class="img"><img src="/images/avatar.jpg" alt="img"></div>
                <div class="info">
                    <div class="info-back">
                        <h2> 
                            
                                cocoafei
                            
                        </h2>
                        <p>
                           
                                iOS / Python
                            
                        </p>
                    </div>
                </div>
            </a>
        </div>
        <!-- 头像效果-end -->
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for cocoafei" class="blog-button">cocoafei</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">个人站</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">欢迎来到我的Blog~</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        

        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">博客主页</a></li>
                
                  <li class="navigation__item"><a href="/archive" title="archive">所有文章</a></li>
                
                  <li class="navigation__item"><a href="/tags" title="tags">标签</a></li>
                
                  <li class="navigation__item"><a href="/about" title="about">关于我</a></li>
                
              </ul>
            </nav>
          </div>          
        </div>


        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-clear"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title">自建局域网 OTA 服务器</h1>
    <div class="post-meta">
      <img src="/images/calendar.png" width="20px" style="vertical-align:middle;"/> 
      <time datetime="2018-11-10 00:00:00 +0800" itemprop="datePublished" class="post-meta__date date" style="vertical-align:middle;">2018-11-10</time>
    </p>  
    </div>
  </header>

  <section class="post">
    <ul>
  <li><a href="#1_0">第一步 编辑前的准备</a></li>
  <li><a href="#2_0">第二步 配置Http服务</a></li>
  <li><a href="#3_0">第三步 生成自签名证书</a></li>
  <li><a href="#4_0">第四步 配置HTTPS服务</a></li>
  <li><a href="#5_0">第五步 放置资源文件</a></li>
  <li><a href="#6_0">参考链接</a></li>
</ul>

<h2 id="第一步-编辑前的准备"><a id="1_0"></a>第一步 编辑前的准备</h2>

<h4 id="11-mac自带-apache-服务器">1.1 Mac自带 Apache 服务器</h4>

<p>Mac 自带 Apache 服务器，我们在终端输入<code class="language-plaintext highlighter-rouge"> sudo apachectl -k start </code>打开网页输入<code class="language-plaintext highlighter-rouge"> localhost</code>，发现网页会显示如下：</p>

<h5 id="it-works">It works!</h5>

<p>Apache 服务器启动成功。</p>

<h4 id="12-修改系统文件前先备份">1.2 修改系统文件前先备份</h4>

<p>例如需要修改<code class="language-plaintext highlighter-rouge"> /etc/apache2 </code>文件夹下 http.conf 文件</p>

<ol>
  <li>切换工作目录下：</li>
</ol>

<p>` cd /etc/apache2 `</p>

<ol>
  <li>备份文件，只需要执行一次：</li>
</ol>

<p>` sudo cp httpd.conf httpd.conf.bak `</p>

<ol>
  <li>如果操作出现错误！可以使用命令，恢复备份的 httpd.conf 文件：</li>
</ol>

<p>` sudo cp httpd.conf.bak httpd.conf `</p>

<h4 id="13-通过-xcode-或者-vim-修改系统文件">1.3 通过 Xcode 或者 vim 修改系统文件</h4>

<p>通过 Xcode 修改比较简单，将文件脱出到桌面一份，修改后拖回原来的文件夹覆盖即可。</p>

<p>注意的是，在<strong>系统目录下是不可以直接用 Xcode 修改</strong>的，可将文件复制到桌面上，用 Xcode 打开修改，然后拖入系统目录下覆盖即可。</p>

<p>通过 vim 修改文件，可直接修改系统文件，修改比较方便。以下修改系统配置文件用到vim，如果不习惯使用vim修改，可使用 Xcode 编辑修改。</p>

<h4 id="14-vim-简单操作">1.4 vim 简单操作</h4>

<ol>
  <li>例如当前目录下有一个 httpd.conf 文件，需要修改第 100 行为 abcdef。</li>
  <li>输入命令<code class="language-plaintext highlighter-rouge"> sudo vim httpd.conf </code>。</li>
  <li>鼠标滚动或者按上下键光标移动到第 100 行，按 i 键进入编辑模式
将第 100 行内容删除并替换为 abcdef 。</li>
  <li>按<code class="language-plaintext highlighter-rouge"> esc </code>键退出编辑。</li>
  <li>输入<code class="language-plaintext highlighter-rouge"> :wq </code>退出并保存；如果编辑错误输入<code class="language-plaintext highlighter-rouge">:q! </code>不保存文件，强制退出vi。</li>
</ol>

<h2 id="第二步-配置http服务"><a id="2_0"></a>第二步 配置Http服务</h2>

<h4 id="21-创建-web-文件夹">2.1 创建 web 文件夹</h4>

<p>我们在当前用户根目录下新建一个web文件夹，然后放入一些文件，如图所示：</p>

<p><img src="/images/posts/ota/ota2.1.png" alt="web 文件夹" /></p>

<h4 id="22-编辑-httpconf-文件">2.2 编辑 http.conf 文件</h4>

<ol>
  <li>切换工作目录下：<code class="language-plaintext highlighter-rouge"> cd /etc/apache2 </code></li>
  <li>备份文件：<code class="language-plaintext highlighter-rouge"> sudo cp httpd.conf httpd.conf.bak </code></li>
  <li>
    <p>用vim编辑httpd.conf文件：<code class="language-plaintext highlighter-rouge"> sudo vim httpd.conf </code></p>
  </li>
  <li>将下面路径更改为你自己web网页路径（约245行）</li>
</ol>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DocumentRoot <span class="s2">"/Library/WebServer/Documents"</span>
&lt;Directory <span class="s2">"/Library/WebServer/Documents”&gt;

修改为我当前用户目录下建立的一个 web 文件夹

DocumentRoot "</span>/Users/lf/web<span class="s2">"
&lt;Directory "</span>/Users/lf/web”&gt;
</code></pre></div></div>

<ol>
  <li>为了便于浏览 web 文件夹，添加 Indexes 字段</li>
</ol>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Options FollowSymLinks Multiviews

修改为

Options Indexes FollowSymLinks Multiviews
</code></pre></div></div>

<p><img src="/images/posts/ota/ota2.2.5.png" alt="修改httpd" /></p>

<ol>
  <li>将下面的#号注释去掉，开启PHP（约177行）</li>
</ol>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#LoadModule php7_module libexec/apache2/libphp7.so</span>

修改为

LoadModule php7_module libexec/apache2/libphp7.so

较旧的系统为（#LoadModule php5_module libexec/apache2/libphp5.so）
</code></pre></div></div>

<p><img src="/images/posts/ota/ota2.2.6.png" alt="开启PHP" /></p>

<ol>
  <li>
    <p>然后按 ESC 键退出编辑，输入<code class="language-plaintext highlighter-rouge"> :wq </code>保存退出。</p>
  </li>
  <li>
    <p>终端中输入<code class="language-plaintext highlighter-rouge"> sudo apachectl -k restart </code>重启 Apache 服务器。</p>
  </li>
  <li>
    <p>开启 apache 服务器.打开浏览器,搜索框中输入<code class="language-plaintext highlighter-rouge"> 127.0.0.1 </code>或者<code class="language-plaintext highlighter-rouge"> localhost </code>就可以看到我们之前添加的网络资源。</p>
  </li>
</ol>

<p><img src="/images/posts/ota/ota2.2.9.png" alt="开启HTTP服务成功" /></p>

<h4 id="23-apache-常用操作命令">2.3 Apache 常用操作命令</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 启动 apache 服务器</span>
<span class="nb">sudo </span>apachectl <span class="nt">-k</span> start

<span class="c"># 重新启动 apache 服务器</span>
<span class="nb">sudo </span>apachectl <span class="nt">-k</span> restart

<span class="c"># 关闭 apache 服务器</span>
<span class="nb">sudo </span>apachectl <span class="nt">-k</span> stop
</code></pre></div></div>

<h4 id="24-重启时报错">2.4 重启时报错</h4>

<p>重启的时候发现报错，但不影响使用</p>

<p><img src="/images/posts/ota/ota2.4.png" alt="ServerName错误" /></p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AH00558: httpd: Could not reliably determine the server's fully

qualified domain name, using LFdeMacBook-Pro.local. Set the

'ServerName' directive globally to suppress this message
</code></pre></div></div>

<p>如果想解决此报错，可再次编辑 httpd.conf 文件</p>

<p>` sudo vim httpd.conf `</p>

<p>将下面的#号注释去掉，并修改（约221行）</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#ServerName www.example.com:80</span>

修改为

ServerName localhost:80
</code></pre></div></div>

<p>然后终端输入下面指令重启即可。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apachectl <span class="nt">-k</span> restart
</code></pre></div></div>

<h2 id="第三步-生成自签名证书"><a id="3_0"></a>第三步 生成自签名证书</h2>

<blockquote>
  <p>iOS7.1 以后， Apple 不再支持 HTTP 方式的 OTA ，所以需要为 Apache 开启 HTTPS 服务，并利用 OpenSSL 制作自签名证书。</p>
</blockquote>

<h4 id="31-生成服务器私钥-serverkey">3.1 生成服务器私钥 server.key</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo mkdir</span> /private/etc/apache2/ssl 

<span class="nb">cd</span> /private/etc/apache2/ssl

<span class="nb">sudo </span>openssl genrsa <span class="nt">-out</span> server.key 1024
</code></pre></div></div>

<p>生成如下所示文件</p>

<p><img src="/images/posts/ota/ota3.1.png" alt="服务器私钥" /></p>

<h4 id="32-生成签署申请">3.2 生成签署申请</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>openssl req <span class="nt">-new</span> <span class="nt">-key</span> server.key <span class="nt">-out</span> server.csr
</code></pre></div></div>

<p>注意：需要完整填写各项信息，注意<code class="language-plaintext highlighter-rouge"> Common Name </code>必须是服务器 ip 或域名，其他信息可以随意填写。例如我需要把 ipa 安装包放在 192.168.1.188 的内网服务器上，则<code class="language-plaintext highlighter-rouge"> Common Name </code>就填写 192.168.1.188 。如果这一步漏填信息，可能会导致最后生成的 ca 文件是空的。</p>

<p><img src="/images/posts/ota/ota3.2.png" alt="生成server.csr" /></p>

<h4 id="33-生成-ca-私钥cacrt">3.3 生成 CA 私钥ca.crt</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>openssl req  <span class="nt">-new</span> <span class="nt">-x509</span> <span class="nt">-days</span> 365 <span class="nt">-key</span> server.key <span class="nt">-out</span> ca.crt
</code></pre></div></div>

<p>填写信息和上面的填写的一样即可，注意<code class="language-plaintext highlighter-rouge"> Common Name </code>必须填写，这里还是填写192.168.1.188即可。</p>

<p><img src="/images/posts/ota/ota3.3.png" alt="生成ca.crt" /></p>

<h4 id="34-创建文件和文件夹">3.4 创建文件和文件夹</h4>

<p>在 ssl 目录下创建 demoCA 文件夹，然后进入 demoCA ，创建一个 index.txt 和 serial文件，index.txt 为空， serial 内容为01，然后在 demoCA 中再创建一个空文件夹 newcerts</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo mkdir </span>demoCA <span class="o">&amp;&amp;</span> <span class="nb">cd </span>demoCA

<span class="nb">sudo mkdir </span>newcerts

<span class="nb">sudo touch </span>index.txt

<span class="nb">sudo touch </span>serial
</code></pre></div></div>

<p>使用 Xcode 或者 vim 编辑 serial 文件，第一行写入 01 保存即可。</p>

<h4 id="35-签名生成servercrt">3.5 签名生成server.crt</h4>

<p>执行命令，返回到ssl文件夹下面</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /private/etc/apache2/ssl
</code></pre></div></div>

<p>然后执行命令，用ca进行签名生成server.crt</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>openssl ca <span class="nt">-in</span> server.csr <span class="nt">-out</span> server.crt <span class="nt">-cert</span> ca.crt <span class="nt">-keyfile</span> server.key
</code></pre></div></div>

<p>这一步可能会报如下错误</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Using configuration from /private/etc/ssl/openssl.cnf

variable lookup failed for ca::default_ca140736040362952:

error:0E06D06C:configuration file routines:NCONF_get_string:

no value:/BuildRoot/Library/Caches/com.apple.xbs/Sources/libressl/

libressl-22.50.2/libressl/crypto/conf/conf_lib.c:323:group=ca name=default_ca
</code></pre></div></div>

<p>这是由于<code class="language-plaintext highlighter-rouge"> /private/etc/ssl/ </code>文件夹下缺少 openssl.cnf 的问题，解决办法是拷贝一份，输入命令</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /usr/local/etc/openssl/openssl.cnf /private/etc/ssl/openssl.cnf
</code></pre></div></div>

<p>使用Xcode或者vim修改<code class="language-plaintext highlighter-rouge"> /private/etc/ssl/openssl.cnf </code>文件，这里使用vim直接修改</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>vim /private/etc/ssl/openssl.cnf
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">dir</span>        <span class="o">=</span> ./demoCA        <span class="c"># Where everything is kept</span>
修改为当前你的demoCA路径
<span class="nb">dir</span>        <span class="o">=</span>  /private/etc/apache2/ssl/demoCA
</code></pre></div></div>

<p>修改完成后再执行命令</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>openssl ca <span class="nt">-in</span> server.csr <span class="nt">-out</span> server.crt <span class="nt">-cert</span> ca.crt <span class="nt">-keyfile</span> server.key
</code></pre></div></div>

<p>会提示有效期和生成证书，都输入y即可。</p>

<p><img src="/images/posts/ota/ota3.5.1.png" alt="生成证书成功提示" /></p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Certificate is to be certified until Nov 10 06:39:36 2019 GMT (365 days)
Sign the certificate? [y/n]:y
（翻译）证书有效期至11月10日06:39:36 2019 GMT(365天)
1 out of 1 certificate requests certified, commit? [y/n]y
签署的证书吗?
（翻译）1 / 1的证书请求被认证，提交?
</code></pre></div></div>

<p>此时我们看到 HTTPS 证书已经生成完成。</p>

<p><img src="/images/posts/ota/ota3.5.2.png" alt="证书列表" /></p>

<h2 id="第四步-配置https服务"><a id="4_0"></a>第四步 配置HTTPS服务</h2>

<h4 id="41-编辑-httpdconf-文件">4.1 编辑 httpd.conf 文件</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>vim /private/etc/apache2/httpd.conf
</code></pre></div></div>

<p>把以下四行代码前头的注释去掉</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LoadModule ssl_module libexec/apache2/mod_ssl.so

LoadModule socache_shmcb_module

libexec/apache2/mod_socache_shmcb.so

Include /private/etc/apache2/extra/httpd-ssl.conf

Include /private/etc/apache2/extra/httpd-vhosts.conf
</code></pre></div></div>

<p>注意：如果你的 httpd.conf 中缺少了某行，你可以自行添加进去即可。</p>

<h4 id="42-编辑-httpd-sslconf-文件">4.2 编辑 httpd-ssl.conf 文件</h4>

<p>编辑前先备份 httpd-ssl.conf 文件</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /private/etc/apache2/extra/ <span class="o">&amp;&amp;</span> <span class="nb">sudo cp </span>httpd-ssl.conf httpd-ssl.conf.bak

<span class="nb">sudo </span>vim /private/etc/apache2/extra/httpd-ssl.conf
</code></pre></div></div>

<p>把以下两行代码的注释去掉，并编辑为你的证书路径</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SSLCertificateFile "/private/etc/apache2/server.crt"
SSLCertificateKeyFile "/private/etc/apache2/server.key"

然后修改路径，改成你的证书文件路径

SSLCertificateFile "/private/etc/apache2/ssl/server.crt"
SSLCertificateKeyFile "/private/etc/apache2/ssl/server.key"
</code></pre></div></div>

<h4 id="43-编辑-httpd-vhostsconf-文件">4.3 编辑 httpd-vhosts.conf 文件</h4>

<p>编辑前先备份 httpd-vhosts.conf 文件</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /private/etc/apache2/extra/ <span class="o">&amp;&amp;</span> <span class="nb">sudo cp </span>httpd-vhosts.conf httpd-vhosts.conf.bak

<span class="nb">sudo </span>vim /private/etc/apache2/extra/httpd-vhosts.conf
</code></pre></div></div>

<p>将 &lt;VirtualHost *:80&gt; 中的第二个修改</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;VirtualHost *:80&gt;
ServerAdmin 192.168.1.188
DocumentRoot "/Users/lf/web"
ServerName 192.168.1.188
ErrorLog "/private/var/log/apache2/dummy-host2.example.com-error_log"
CustomLog "/private/var/log/apache2/dummy-host2.example.com-access_log" common
&lt;/VirtualHost&gt;
</code></pre></div></div>

<p>然后在文件末尾添加 443 端口服务</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;VirtualHost *:443&gt; 
SSLEngine on 
SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
SSLCertificateFile /private/etc/apache2/ssl/server.crt
SSLCertificateKeyFile /private/etc/apache2/ssl/server.key
ServerName 192.168.1.188
DocumentRoot "/Users/lf/web"
&lt;/VirtualHost&gt;
</code></pre></div></div>

<p>注意：</p>

<ul>
  <li>SSLCertificateFile 填写生成的 server.crt</li>
  <li>SSLCertificateKeyFile 填写生成的 server.key</li>
  <li>ServerName 填写你的 ip</li>
  <li>DocumentRoot 填写你的站点路径</li>
</ul>

<h4 id="44-检查-apache-配置">4.4 检查 Apache 配置</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apachectl configtest
</code></pre></div></div>

<p>如果它提示：<code class="language-plaintext highlighter-rouge"> Syntax OK </code>，那就完成90%了，如果它提示有错，那就要根据错误提示自行解决了。</p>

<p>我在这个环节遇到了一个错误</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SSLSessionCache: 'shmcb' session cachenot supported 
(known names: ). Maybe you need toload the appropriate
socache module (mod_socache_shmcb?).
</code></pre></div></div>

<p>解决办法如下：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>vim /private/etc/apache2/httpd.conf
</code></pre></div></div>

<p>然后把以下代码的注释去掉</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LoadModule socache_shmcb_module libexec/apache2/mod_socache_shmcb.so
</code></pre></div></div>

<p>去掉注释后，保存，重新检查配置，直到成功。</p>

<p>注意：
从网上查找的路径可能是<code class="language-plaintext highlighter-rouge"> LoadModule socache_shmcb_module modules/mod_socache_shmcb.so </code>，
但我的配置文件中，路径跟上述的不一致，但结尾都是<code class="language-plaintext highlighter-rouge"> mod_socache_shmcb.so </code>就对了。</p>

<p>解决方案是参考这篇文章的<a href="http://stackoverflow.com/questions/20127138/apache-2-4-configuration-for-ssl-not-working">stackoverflow问答</a>。</p>

<p>重启 Apache 服务<code class="language-plaintext highlighter-rouge"> sudo apachectl -k restart </code>，
这样就可以用 https 访问本地服务器了。</p>

<h2 id="第五步-放置资源文件"><a id="5_0"></a>第五步 放置资源文件</h2>

<h4 id="51-网站资源文件">5.1 网站资源文件</h4>

<p>如下图所示，在<code class="language-plaintext highlighter-rouge"> /Users/lf/web </code>文件夹下放置的资源如下：</p>

<p><img src="/images/posts/ota/ota5.1.png" alt="资源文件夹" /></p>

<p>文件夹名称可任意取，只要在 index.html 和 plist 文件夹中路径对应即可。index.html 不要改名字，默认。</p>

<ul>
  <li>ca.crt  CA证书，将<code class="language-plaintext highlighter-rouge"> /private/etc/apache2/ssl/ca.crt </code>拷贝一份到当前 web 文件夹下</li>
  <li>ipa 文件夹，放置 ipa 资源包</li>
  <li>plist 文件夹，放置 plist 文件</li>
  <li>index.html 索引网页，放置链接下载安装证书和ipa</li>
  <li>images 文件夹，按照 Xcode 要求放置一个 57×57 和 512×512 的 png 图片，还没发现什么用途。</li>
</ul>

<h4 id="52-放置-ipa-包">5.2 放置 ipa 包</h4>
<p>APP 打包，导出 ipa 包就没必要多说了，可以导出 Ad Hoc 或者 Development 的 ipa 包，将 ipa 放在放在 web 文件夹下 ipa 文件夹中。</p>

<h4 id="53-放置plist文件">5.3 放置plist文件</h4>

<p>想在线安装，还需要一个 plist 文件，每个 ipa 包对应一个 plist 文件，将<code class="language-plaintext highlighter-rouge"> https://192.168.1.188/ipa/LFDev_4.2.1.ipa </code>更改为生成证书时的 ip 或者域名，然后对应 ipa 文件路径即可，例如这里的路经是，在当前 web 文件夹下的 ipa 文件夹中，名称为 LFDev_4.2.1.ipa 的 ipa 文件。</p>

<p>plist 文件格式如下：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
<span class="nt">&lt;dict&gt;</span>
<span class="nt">&lt;key&gt;</span>items<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;array&gt;</span>
<span class="nt">&lt;dict&gt;</span>
<span class="nt">&lt;key&gt;</span>assets<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;array&gt;</span>
<span class="nt">&lt;dict&gt;</span>
<span class="nt">&lt;key&gt;</span>kind<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>software-package<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;key&gt;</span>url<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>https://192.168.1.188/ipa/LFDev_4.2.1.ipa<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;dict&gt;</span>
<span class="nt">&lt;key&gt;</span>kind<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>display-image<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;key&gt;</span>url<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>https://192.168.1.188/images/image_57×57.png<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;dict&gt;</span>
<span class="nt">&lt;key&gt;</span>kind<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>full-size-image<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;key&gt;</span>url<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>https://192.168.1.188/images/image_512×512.png<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/array&gt;</span>
<span class="nt">&lt;key&gt;</span>metadata<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;dict&gt;</span>
<span class="nt">&lt;key&gt;</span>bundle-identifier<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>com.xxx.yyy<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;key&gt;</span>bundle-version<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>4.2.0<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;key&gt;</span>kind<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>software<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;key&gt;</span>title<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>Cxx<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/array&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
</code></pre></div></div>

<ul>
  <li>bundle-identifier的值com.xxx.yyy更改为你应用的Bundle ID</li>
  <li>bundle-version的值4.2.0更改为你应用的版本version</li>
  <li>title的值Cxx更改为你应用的名称，下载时会弹出安装提示此名称</li>
</ul>

<h4 id="54-创建索引下载网页-indexhtml">5.4 创建索引下载网页 index.html</h4>

<p>在<code class="language-plaintext highlighter-rouge"> /Users/lf/web </code>文件夹下还需要一个 index.html 文件，
手机首次使用 OTA 安装，必须先下载安装 ca.crt 证书，然后再点击安装 ipa。
url 中必须填写 https 开头的 plist 文件下载地址，plist 文件中对应 ipa 文件的下载地址。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span><span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"Content-Type"</span> <span class="na">content=</span><span class="s">"text/html; charset=UTF-8"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h4&gt;</span>手机首次下载请先"点击安装SSL证书"，并根据提示安装信任证书<span class="nt">&lt;/h4&gt;</span>
在 iOS 10.3 及更高版本中，手动安装包含证书有效负载的描述文件时，这个证书不会自动受 SSL 信任。
当安装通过电子邮件发送或从网站下载的描述文件时，您必须手动开启受 SSL 信任。
要为这个证书开启受 SSL 信任，请前往“设置”&gt;“通用”&gt;“关于本机”&gt;“证书信任设置”。在“针对根证书启用完全信任”下，开启信任这个证书。
<span class="nt">&lt;a</span> <span class="na">title=</span><span class="s">"iPhone"</span> <span class="na">href=</span><span class="s">"https://192.168.1.188/ca.crt"</span><span class="nt">&gt;</span>👉点击安装SSL证书👈<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;hr&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"itms-services://?action=download-manifest&amp;url=https://192.168.1.188/plist/LFAdHoc_4.2.0.plist"</span> <span class="na">class=</span><span class="s">"app_link"</span><span class="nt">&gt;</span>👉点击安装4.2.0生产版本👈<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;hr&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"itms-services://?action=download-manifest&amp;url=https://192.168.1.188/plist/LFDev_4.2.1.plist"</span> <span class="na">class=</span><span class="s">"app_link"</span><span class="nt">&gt;</span>👉点击安装4.2.1开发版本👈<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;hr&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"itms-services://?action=download-manifest&amp;url=https://192.168.1.188/plist/LFVali_4.2.1.plist"</span> <span class="na">class=</span><span class="s">"app_link"</span><span class="nt">&gt;</span>👉点击安装4.2.1验证版本👈<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;hr&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>如果是想 ipa 放在局域网电脑上面，则将当做打包服务器的电脑 ip 手动设置固定 ip：192.168.1.188，然后手机和电脑连接同一个路由器，iphone 的 Safari 浏览器中输入 192.168.1.188 或者 192.168.1.188/index.html 即可，点击安装 SSL 证书，然后点击安装 ipa 包。</p>

<h4 id="55-ios-103-后必须设置证书信任">5.5 iOS 10.3 后必须设置证书信任</h4>

<p>如果下载 ipa 时出现无法连接到<code class="language-plaintext highlighter-rouge"> 192.168.*.* </code>的错误，则需要手动设置信任。</p>

<p>iOS7.0 以后必须使用 HTTPS 进行，iOS 10 之前的设备，直接安装自签名根证书后就可以安装 iOS 应用，但是在 iOS 10.3 以上的设备上，安装后还需要到“关于本机”那里手动开启信任。</p>

<p>苹果官网提示，在 iOS 中信任手动安装的证书描述文件 <a href="https://support.apple.com/zh-cn/HT204477">https://support.apple.com/zh-cn/HT204477</a></p>

<blockquote>
  <p>在 iOS 10.3 及更高版本中，手动安装包含证书有效负载的描述文件时，
这个证书不会自动受 SSL 信任。
当安装通过电子邮件发送或从网站下载的描述文件时，
您必须手动开启受 SSL 信任。
要为这个证书开启受 SSL 信任，
请前往“设置”&gt;“通用”&gt;“关于本机”&gt;“证书信任设置”。
在“针对根证书启用完全信任”下，开启信任这个证书。</p>
</blockquote>

<h2 id="参考链接"><a id="6_0"></a>参考链接</h2>

<p><code class="language-plaintext highlighter-rouge">http://stackoverflow.com/questions/20127138/apache-2-4-configuration-for-ssl-not-working</code></p>


  </section>
</article>

<section>

    <div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';"></div>

    <ul class="pager">
        
        <li class="previous">
            <a href="/2018/10/%E8%AE%B0%E4%B8%80%E4%BA%9B%E5%8D%B0%E8%B1%A1%E6%B7%B1%E5%88%BB%E7%9A%84-Bug/" data-toggle="tooltip"
                data-placement="top" title="记一些印象深刻的 Bug">上一篇： <span>记一些印象深刻的 Bug</span>
            </a>
        </li>
        
        
        <li class="next">
            <a href="/2019/06/iOS-%E5%A6%82%E4%BD%95%E5%87%86%E7%A1%AE%E6%98%BE%E7%A4%BA%E8%A7%92%E6%A0%87/" data-toggle="tooltip"
                data-placement="top" title="iOS 如何准确显示角标">下一篇： <span>iOS 如何准确显示角标</span>
            </a>
        </li>
        
    </ul>
</section>
<section class="post-comments">

</section>


            <section class="footer">
    <footer>
        <div class = "footer_div">
            <nav class="cover-navigation navigation--social">
                <ul class="navigation">
                    
                    
                    <!-- Github -->
                    <li class="navigation__item_social">
                        <a href="https://github.com/muzipiao" title="@muzipiao 的 Github" target="_blank">
                            <div class="footer-social-icon" style="background-image:url(/images/github.png);"></div>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    <!-- Zhihu -->
                    <li class="navigation__item_social">
                        <a href="https://juejin.im/user/5b2f1c51f265da59ad439f69" title="@5b2f1c51f265da59ad439f69" target="_blank">
                            <div class="footer-social-icon" style="background-image:url(/images/juejin.png);"></div>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <!-- Email -->
                    <li class="navigation__item_social">
                        <a href="mailto:lifei_zdjl@126.com" title="Contact me">
                            <div class="footer-social-icon" style="background-image:url(/images/email.png);"></div>
                        </a>
                    </li>
                    
                    
                    <!-- RSS -->
                    <li class="navigation__item_social">
                        <a href="/feed.xml" rel="author" title="RSS" target="_blank">
                            <div class="footer-social-icon" style="background-image:url(/images/rss.png);"></div>
                            <span class="label">RSS</span>
                        </a>
                    </li>
                    
                </ul>
            </nav>
        </div>
        <div><br><br></div>
        <div class="footer__copyright" >
            <br>
            <span>©2020&nbsp;cocoafei&nbsp;</span>
            <img src="/images/beian.png"/>
            <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010702002032" target="_blank">京公网安备 11010702002032号</a>
            <span>&nbsp;</span>
            <a href="http://beian.miit.gov.cn/" target="_blank">京ICP备2020033870号</a>
        </div>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//libs.baidu.com/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



    
  </body>

</html>
