I"´q<h2 id="ä¸€åˆ©ç”¨-shell-è„šæœ¬å°†-app-è‡ªåŠ¨è½¬æ¢ä¸º-ipa">ä¸€ã€åˆ©ç”¨ Shell è„šæœ¬å°† .app è‡ªåŠ¨è½¬æ¢ä¸º .ipa</h2>

<ol>
  <li>åœ¨é¡¹ç›® <code class="language-plaintext highlighter-rouge">command + b</code> ç¼–è¯‘å®Œæˆç”Ÿæˆåç¼€åä¸º .app çš„æ–‡ä»¶ï¼Œé€‰æ‹©å·¥ç¨‹çš„ Products æ–‡ä»¶å¤¹ï¼Œå±•å¼€é€‰æ‹©ç¼–è¯‘ç”Ÿæˆçš„ .app æ–‡ä»¶ï¼Œå³é”®â€“&gt;Show in Finderï¼Œå³å¯æ‰¾åˆ° .app æ–‡ä»¶ï¼›</li>
  <li>å°† convert-ipa.sh å’Œ .app åç¼€åæ–‡ä»¶æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­;</li>
  <li>å°† convert-ipa.sh æ‹–å…¥ç»ˆç«¯ï¼Œå›è½¦å³å¯ï¼›</li>
  <li>è½¬æ¢å®Œæˆçš„ ipa æ–‡ä»¶åœ¨ IPAFolder æ–‡ä»¶å¤¹ä¸­ã€‚</li>
</ol>

<p>è½¬æ¢ä¸º ipa çš„ Shell è„šæœ¬å¦‚ä¸‹:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>

<span class="c"># è„šæœ¬ç›®å½•å’Œxxx.appè¦åœ¨åŒä¸€ä¸ªç›®å½•ï¼Œå¦‚æœæƒ³è¦é…ç½®ï¼Œè¯·å¡«å…¥åŒ…å«åç¼€åçš„å…¨ç§°</span>
<span class="nv">g_app_name</span><span class="o">=</span><span class="s2">""</span>

<span class="c"># åœ¨å½“å‰ç›®å½•ä¸‹æ‰¾åˆ° .app æ–‡ä»¶</span>
AutoFindAppFolder<span class="o">()</span> <span class="o">{</span>
	<span class="k">for </span>p_file <span class="k">in</span> ./<span class="k">*</span><span class="p">;</span> <span class="k">do</span>
		<span class="c">#åˆ¤æ–­æ˜¯å¦ä¸ºæ–‡ä»¶å¤¹</span>
		<span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$p_file</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
			</span><span class="nv">file_name</span><span class="o">=</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$p_file</span><span class="s2">"</span><span class="si">)</span>
			<span class="c">#åˆ¤æ–­åç¼€åç§°æ˜¯å¦æ˜¯app</span>
			<span class="nv">file_last</span><span class="o">=</span><span class="k">${</span><span class="nv">file_name</span><span class="p">##*.</span><span class="k">}</span>
            <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$file_last</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"app"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                </span><span class="nv">g_app_name</span><span class="o">=</span><span class="s2">"</span><span class="nv">$file_name</span><span class="s2">"</span>
            <span class="k">fi
		fi
	done</span>
<span class="o">}</span>

<span class="c"># æ‰“åŒ…ipa</span>
AppToIpa<span class="o">()</span> <span class="o">{</span>
    <span class="nv">app_file_name</span><span class="o">=</span><span class="nv">$1</span>
    <span class="c"># å…ˆåˆ é™¤é‡Œé¢å½“å‰çš„IPAFolderæ–‡ä»¶å¤¹</span>
    <span class="nb">rm</span> <span class="nt">-rf</span> IPAFolder
    <span class="c"># å†åˆ›å»ºIPAFolderæ–‡ä»¶å¤¹</span>
    <span class="nb">mkdir </span>IPAFolder
    <span class="c"># åœ¨æ–‡ä»¶å¤¹é‡Œé¢åˆ›å»ºPayloadæ–‡ä»¶å¤¹</span>
    <span class="nb">mkdir </span>IPAFolder/Payload
    <span class="c"># å°†å½“å‰ç›®å½•ä¸‹çš„App_Name.appå¤åˆ¶åˆ°Payloadé‡Œé¢</span>
    <span class="nb">cp</span> <span class="nt">-r</span> <span class="s2">"</span><span class="nv">$app_file_name</span><span class="s2">"</span> IPAFolder/Payload/<span class="s2">"</span><span class="nv">$app_file_name</span><span class="s2">"</span>
    <span class="c"># è¿›å…¥IPAFolderæ–‡ä»¶å¤¹</span>
    <span class="nb">cd </span>IPAFolder
    <span class="c"># å‹ç¼©å¤šä¸ªç›®å½•zip FileName.zip ç›®å½•1 ç›®å½•2 ç›®å½•3....</span>
    <span class="nv">file_head</span><span class="o">=</span><span class="k">${</span><span class="nv">app_file_name</span><span class="p">%.*</span><span class="k">}</span>
    zip <span class="nt">-r</span> <span class="s2">"</span><span class="nv">$file_head</span><span class="s2">.ipa"</span> Payload
    <span class="nb">echo</span> <span class="s2">"*** ipa æ–‡ä»¶å·²ç»åˆ›å»ºåˆ° IPAFolder æ–‡ä»¶å¤¹ä¸‹ ***"</span>
<span class="o">}</span>

<span class="nb">cd</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">exit </span>0

<span class="c"># å¦‚æœæœªè®¾ç½®ï¼Œåˆ™è‡ªåŠ¨è·å–ä¸€æ¬¡</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$g_app_name</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span>AutoFindAppFolder
<span class="k">fi</span>
<span class="c"># å¦‚æœè‡ªåŠ¨è·å–ä»æ—§ä¸ºç©ºï¼Œæç¤º</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$g_app_name</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"*** å½“å‰è„šæœ¬æ–‡ä»¶å¤¹ä¸‹æ‰¾ä¸åˆ°åç¼€å .app çš„æ–‡ä»¶ ***"</span>
<span class="k">else</span>
  <span class="c"># è½¬æ¢</span>
  AppToIpa <span class="s2">"</span><span class="nv">$g_app_name</span><span class="s2">"</span>
<span class="k">fi</span>
</code></pre></div></div>

<h2 id="äºŒåˆ©ç”¨-shell-è„šæœ¬è‡ªåŠ¨æ‰“åŒ…">äºŒã€åˆ©ç”¨ Shell è„šæœ¬è‡ªåŠ¨æ‰“åŒ…</h2>

<p>ä¸»è¦ Shell è„šæœ¬å¦‚ä¸‹ï¼Œå®Œæ•´è„šæœ¬è¯·è‡³ Git ä¸‹è½½(æ–‡ç« æœ«å°¾æœ‰ä¸‹è½½é“¾æ¥):</p>

<ol>
  <li>å°† auto-archive.sh è„šæœ¬å¤åˆ¶åˆ°æ–‡ä»¶åç¼€å .xcodeproj æ‰€åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼›</li>
  <li>å°† auto-archive.sh æ‹–å…¥ç»ˆç«¯ï¼Œå›è½¦å³å¯ï¼›</li>
  <li>å¦‚æœè‡ªåŠ¨æ‰“åŒ…å¤±è´¥ï¼Œè¯·æ‰“å¼€ auto-archive.sh é…ç½®é¡¹ç›®ä¿¡æ¯ï¼›</li>
  <li>å¦‚æœé¡¹ç›®ç›®å½•æ—  ExportOptions.plist æ–‡ä»¶ï¼Œè¯·å‚è€ƒæ–°å»ºã€‚</li>
</ol>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="c"># æ‰“åŒ…è„šæœ¬, å°†æ­¤è„šæœ¬æ”¾åœ¨åç¼€åä¸ºxcodeprojçš„æ–‡ä»¶åŒçº§ç›®å½•ä¸‹å³å¯</span>

<span class="c">#å·¥ç¨‹åç§°ï¼Œæ³¨æ„ï¼šExportOptions.plistæ–‡ä»¶å¿…é¡»æ”¾åˆ°"å·¥ç¨‹å.xcodeproj"åŒçº§ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ç»ˆç«¯ä¸­è¾“å…¥"cd å½“å‰å·¥ç¨‹å.xcodeprojæ‰€åœ¨æ–‡ä»¶è·¯å¾„"ï¼Œåœ¨æ‹–å…¥æ­¤Shellè„šæœ¬å³å¯ã€‚</span>
<span class="nv">g_project_name</span><span class="o">=</span><span class="s2">""</span>

<span class="c">#æ‰“åŒ…æ¨¡å¼ Debug/Release</span>
<span class="nv">g_development_mode</span><span class="o">=</span><span class="s2">"Release"</span>

<span class="c">#schemeå</span>
<span class="nv">g_scheme_name</span><span class="o">=</span><span class="s2">""</span>

<span class="c">#plistæ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼Œé‡Œé¢éœ€è¦åŒ…å«Bundle IDå’Œæè¿°æ–‡ä»¶åç§°ï¼Œæ³¨æ„ï¼šExportOptions.plistæ–‡ä»¶å¿…é¡»æ”¾åˆ°"å·¥ç¨‹å.xcodeproj"åŒçº§ç›®å½•ä¸‹</span>
<span class="nv">g_export_options</span><span class="o">=</span><span class="s2">"ExportOptions.plist"</span>

<span class="c">#å¯¼å‡º.ipaæ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼Œé»˜è®¤åœ¨æ¡Œé¢çš„ auto-ipa æ–‡ä»¶å¤¹ä¸‹</span>
<span class="nv">g_ipa_path</span><span class="o">=</span><span class="s2">"~/Desktop/auto-ipa"</span>

<span class="c">#å¯¼å‡º ipa æ–‡ä»¶çš„æ—¶é—´</span>
<span class="nv">g_current_time</span><span class="o">=</span><span class="s2">""</span>

<span class="c"># æ‰¾åˆ°xcodeprojæ–‡ä»¶æˆ–è€…xcworkspaceæ–‡ä»¶</span>
FindProjFile<span class="o">()</span> <span class="o">{</span>
	<span class="k">for </span>file <span class="k">in</span> ./<span class="k">*</span><span class="p">;</span> <span class="k">do</span>
		<span class="c">#åˆ¤æ–­æ˜¯å¦ä¸ºæ–‡ä»¶å¤¹</span>
		<span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
			</span><span class="nv">file_name</span><span class="o">=</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span><span class="si">)</span>
			<span class="c">#åˆ¤æ–­åç¼€åç§°</span>
			<span class="nv">file_last</span><span class="o">=</span><span class="k">${</span><span class="nv">file_name</span><span class="p">##*.</span><span class="k">}</span>
            <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$file_last</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"xcodeproj"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                </span><span class="nv">g_project_name</span><span class="o">=</span><span class="nv">$file_name</span>
            <span class="k">fi
            if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$file_last</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"xcworkspace"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                </span><span class="nv">g_project_name</span><span class="o">=</span><span class="nv">$file_name</span>
                <span class="nb">break
            </span><span class="k">fi
		fi
	done</span>
<span class="o">}</span>

<span class="c"># è‡ªåŠ¨æ‰¾åˆ°scheme</span>
<span class="c"># list_proj=$(xcodebuild -list -project "$file_proj")</span>
<span class="c"># list_scheme=${list_proj##*:}</span>
<span class="c"># ä½¿ç”¨awkå»é™¤æ¢è¡Œï¼Œä½¿ç”¨sedå»é™¤ç©ºæ ¼</span>
<span class="c"># g_scheme_name=$(echo "$list_scheme" | awk '{printf "%s",$1}'| sed "s/ //g")</span>
FindScheme<span class="o">()</span> <span class="o">{</span>
    <span class="nv">temp_project_name</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nv">file_proj</span><span class="o">=</span><span class="k">${</span><span class="nv">temp_project_name</span><span class="p">%.*</span><span class="k">}</span>.xcodeproj
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$file_proj</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">proj_setting</span><span class="o">=</span><span class="si">$(</span>xcodebuild <span class="nt">-showBuildSettings</span><span class="si">)</span>
        <span class="nv">s_scheme</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$proj_setting</span><span class="s2">"</span> | <span class="nb">grep </span>TARGET_NAME<span class="si">)</span>
        <span class="nv">g_scheme_name</span><span class="o">=</span><span class="k">${</span><span class="nv">s_scheme</span><span class="p">#*= </span><span class="k">}</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># åˆ›å»ºExportOptions.plist æ–‡ä»¶</span>
CreateExportOptionsPlist<span class="o">()</span> <span class="o">{</span>
    <span class="nv">export_plist</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nv">proj_setting</span><span class="o">=</span><span class="si">$(</span>xcodebuild <span class="nt">-showBuildSettings</span><span class="si">)</span>
    <span class="nv">s_identifier</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$proj_setting</span><span class="s2">"</span> | <span class="nb">grep </span>PRODUCT_BUNDLE_IDENTIFIER<span class="si">)</span>
    <span class="nv">k_id</span><span class="o">=</span><span class="k">${</span><span class="nv">s_identifier</span><span class="p">#*= </span><span class="k">}</span>
    <span class="nv">s_provision</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$proj_setting</span><span class="s2">"</span> | <span class="nb">grep </span>PROVISIONING_PROFILE_SPECIFIER<span class="si">)</span>
    <span class="nv">k_pr</span><span class="o">=</span><span class="k">${</span><span class="nv">s_provision</span><span class="p">#*= </span><span class="k">}</span>
    <span class="nv">s_team_id</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$proj_setting</span><span class="s2">"</span> | <span class="nb">grep </span>DEVELOPMENT_TEAM<span class="si">)</span>
    <span class="nv">k_te</span><span class="o">=</span><span class="k">${</span><span class="nv">s_team_id</span><span class="p">#*= </span><span class="k">}</span>

    <span class="c"># æ·»åŠ team id</span>
    /usr/libexec/PlistBuddy <span class="nt">-c</span> <span class="s2">"Add :teamID string </span><span class="nv">$k_te</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$export_plist</span><span class="s2">"</span>
    <span class="c"># æ·»åŠ æè¿°æ–‡ä»¶</span>
    /usr/libexec/PlistBuddy <span class="nt">-c</span> <span class="s2">"Add :provisioningProfiles dict"</span> <span class="s2">"</span><span class="nv">$export_plist</span><span class="s2">"</span>
    <span class="c"># æ·»åŠ valueå€¼,</span>
    /usr/libexec/PlistBuddy <span class="nt">-c</span> <span class="s2">"Add :provisioningProfiles:</span><span class="nv">$k_id</span><span class="s2"> string </span><span class="nv">$k_pr</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$export_plist</span><span class="s2">"</span>

    <span class="nb">echo</span> <span class="s2">"*** teamIDï¼š</span><span class="nv">$k_te</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"*** provisioningProfilesï¼š</span><span class="nv">$k_id</span><span class="s2">:</span><span class="nv">$k_pr</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># å¯¼å‡ºipa</span>
ArchiveIpa<span class="o">()</span> <span class="o">{</span>
    <span class="nv">proj_name</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nv">proj_export_plist</span><span class="o">=</span><span class="nv">$2</span>
    <span class="nv">proj_scheme</span><span class="o">=</span><span class="nv">$3</span>
    <span class="nv">proj_ipa_path</span><span class="o">=</span><span class="nv">$4</span>
    <span class="c"># è·å–æ—¶é—´ å¦‚:20190613-092619</span>
    <span class="nv">g_current_time</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d-%H%M%S<span class="si">)</span><span class="s2">"</span>
    <span class="nv">ipa_folder</span><span class="o">=</span><span class="s2">"</span><span class="nv">$proj_ipa_path</span><span class="s2">/</span><span class="nv">$proj_scheme$g_current_time</span><span class="s2">"</span>

    xcodebuild <span class="nt">-exportArchive</span> <span class="nt">-archivePath</span> build/<span class="s2">"</span><span class="nv">$proj_name</span><span class="s2">"</span>.xcarchive <span class="se">\</span>
	<span class="nt">-exportPath</span> <span class="s2">"</span><span class="nv">$ipa_folder</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">-destination</span> generic/platform<span class="o">=</span>ios <span class="se">\</span>
	<span class="nt">-exportOptionsPlist</span> <span class="s2">"</span><span class="nv">$proj_export_plist</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">-allowProvisioningUpdates</span> <span class="se">\</span>
	<span class="nt">-quiet</span> <span class="o">||</span> <span class="nb">exit</span>

    <span class="c"># åˆ é™¤buildåŒ…</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> build <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">rm</span> <span class="nt">-rf</span> build <span class="nt">-r</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># ç¼–è¯‘é¡¹ç›®</span>
BuildProj<span class="o">()</span> <span class="o">{</span>
    <span class="nv">proj_name</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nv">proj_mode</span><span class="o">=</span><span class="nv">$2</span>
    <span class="nv">proj_scheme</span><span class="o">=</span><span class="nv">$3</span>
    <span class="nv">proj_export_plist</span><span class="o">=</span><span class="nv">$4</span>
    <span class="nv">proj_ipa_path</span><span class="o">=</span><span class="nv">$5</span>

    <span class="nb">echo</span> <span class="s2">"*** æ­£åœ¨æ¸…ç†å·¥ç¨‹ ***"</span>
    xcodebuild clean  <span class="nt">-project</span> <span class="s2">"</span><span class="nv">$proj_name</span><span class="s2">"</span>.xcodeproj <span class="se">\</span>
    <span class="nt">-scheme</span> <span class="s2">"</span><span class="nv">$proj_scheme</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">-configuration</span> <span class="s2">"</span><span class="nv">$proj_mode</span><span class="s2">"</span> <span class="nt">-quiet</span> <span class="o">||</span> <span class="nb">exit
    echo</span> <span class="s2">"*** æ¸…ç†å®Œæˆ     ***"</span>

    <span class="nb">echo</span> <span class="s2">"*** æ­£åœ¨ç¼–è¯‘ For </span><span class="nv">$proj_mode</span><span class="s2">"</span>
    xcodebuild <span class="se">\</span>
    archive <span class="nt">-project</span> <span class="s2">"</span><span class="nv">$proj_name</span><span class="s2">"</span>.xcodeproj <span class="se">\</span>
    <span class="nt">-scheme</span> <span class="s2">"</span><span class="nv">$proj_scheme</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">-configuration</span> <span class="s2">"</span><span class="nv">$proj_mode</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">-archivePath</span> build/<span class="s2">"</span><span class="nv">$proj_name</span><span class="s2">"</span>.xcarchive <span class="se">\</span>
    <span class="nt">-destination</span> generic/platform<span class="o">=</span>ios <span class="nt">-quiet</span> <span class="o">||</span> <span class="nb">exit
    echo</span> <span class="s2">"*** ç¼–è¯‘å®Œæˆ     ***"</span>

    <span class="c"># å¯¼å‡ºipa</span>
    <span class="nb">echo</span> <span class="s2">"*** æ­£åœ¨å¯¼å‡ºipa  ***"</span>
    ArchiveIpa <span class="s2">"</span><span class="nv">$proj_name</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$proj_export_plist</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$proj_scheme</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$proj_ipa_path</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"*** ipa å·²å¯¼å‡ºåˆ°ç›®å½•ï¼š</span><span class="nv">$proj_ipa_path</span><span class="s2">"</span>
<span class="o">}</span>

BuildWorkspace<span class="o">()</span> <span class="o">{</span>
    <span class="nv">proj_name</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nv">proj_mode</span><span class="o">=</span><span class="nv">$2</span>
    <span class="nv">proj_scheme</span><span class="o">=</span><span class="nv">$3</span>
    <span class="nv">proj_export_plist</span><span class="o">=</span><span class="nv">$4</span>
    <span class="nv">proj_ipa_path</span><span class="o">=</span><span class="nv">$5</span>

    <span class="nb">echo</span> <span class="s2">"*** æ­£åœ¨æ¸…ç†å·¥ç¨‹ ***"</span>
    xcodebuild clean  <span class="nt">-workspace</span> <span class="s2">"</span><span class="nv">$proj_name</span><span class="s2">"</span>.xcworkspace <span class="se">\</span>
    <span class="nt">-scheme</span> <span class="s2">"</span><span class="nv">$proj_scheme</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">-configuration</span> <span class="s2">"</span><span class="nv">$proj_mode</span><span class="s2">"</span> <span class="nt">-quiet</span> <span class="o">||</span> <span class="nb">exit
    echo</span> <span class="s2">"*** æ¸…ç†å®Œæˆ     ***"</span>

    <span class="nb">echo</span> <span class="s2">"*** æ­£åœ¨ç¼–è¯‘ For </span><span class="nv">$proj_mode</span><span class="s2">"</span>
    xcodebuild <span class="se">\</span>
    archive <span class="nt">-workspace</span> <span class="s2">"</span><span class="nv">$proj_name</span><span class="s2">"</span>.xcworkspace <span class="se">\</span>
    <span class="nt">-scheme</span> <span class="s2">"</span><span class="nv">$proj_scheme</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">-configuration</span> <span class="s2">"</span><span class="nv">$proj_mode</span><span class="s2">"</span> <span class="se">\</span>
    <span class="nt">-archivePath</span> build/<span class="s2">"</span><span class="nv">$proj_name</span><span class="s2">"</span>.xcarchive <span class="se">\</span>
    <span class="nt">-destination</span> generic/platform<span class="o">=</span>ios <span class="nt">-quiet</span> <span class="o">||</span> <span class="nb">exit
    echo</span> <span class="s2">"*** ç¼–è¯‘å®Œæˆ     ***"</span>

     <span class="c"># å¯¼å‡ºipa</span>
    <span class="nb">echo</span> <span class="s2">"*** æ­£åœ¨å¯¼å‡ºipa  ***"</span>
    ArchiveIpa <span class="s2">"</span><span class="nv">$proj_name</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$proj_export_plist</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$proj_scheme</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$proj_ipa_path</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"*** ipa å·²å¯¼å‡ºåˆ°ç›®å½•ï¼š</span><span class="nv">$proj_ipa_path</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># ç¨‹åºä¸»æ–¹æ³•</span>
Main<span class="o">()</span> <span class="o">{</span>
    <span class="c"># è‡ªåŠ¨è·å–é¡¹ç›®åç§°</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$g_project_name</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>FindProjFile
    <span class="k">fi</span>

    <span class="c"># è‡ªåŠ¨è·å–scheme</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$g_scheme_name</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>FindScheme <span class="s2">"</span><span class="nv">$g_project_name</span><span class="s2">"</span>
    <span class="k">fi

    if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$g_project_name</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$g_scheme_name</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"*** æç¤ºï¼šé¡¹ç›®åç§°æˆ– scheme è·å–å¤±è´¥ã€‚ ***"</span>
        <span class="nb">exit </span>0
    <span class="k">fi

    if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$g_export_options</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"*** æœªå‘ç°ExportOptions.plistæ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ›å»ºä¸­... ***"</span>
        CreateExportOptionsPlist <span class="s2">"</span><span class="nv">$g_export_options</span><span class="s2">"</span>
    <span class="k">fi

    </span><span class="nb">echo</span> <span class="s2">"*** é¡¹ç›®é…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š ***"</span>
    <span class="nb">echo</span> <span class="s2">"*** å·¥ç¨‹åç§°ï¼š</span><span class="nv">$g_project_name</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"*** æ‰“åŒ…æ¨¡å¼ï¼š</span><span class="nv">$g_development_mode</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"*** schemeï¼š</span><span class="nv">$g_scheme_name</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"*** å¯¼å‡ºé…ç½®ï¼š</span><span class="nv">$g_export_options</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"*** å¯¼å‡ºè·¯å¾„ï¼š</span><span class="nv">$g_ipa_path</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"*** é¡¹ç›®é…ç½®å®Œæ¯• ***"</span>

    <span class="c"># è·å–åç§°å’Œåç¼€</span>
    <span class="nv">file_head</span><span class="o">=</span><span class="k">${</span><span class="nv">g_project_name</span><span class="p">%.*</span><span class="k">}</span>
    <span class="nv">file_last</span><span class="o">=</span><span class="k">${</span><span class="nv">g_project_name</span><span class="p">##*.</span><span class="k">}</span>
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$file_last</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"xcworkspace"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span>BuildWorkspace <span class="s2">"</span><span class="nv">$file_head</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$g_development_mode</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$g_scheme_name</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$g_export_options</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$g_ipa_path</span><span class="s2">"</span>
    <span class="k">else
        </span>BuildProj <span class="s2">"</span><span class="nv">$file_head</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$g_development_mode</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$g_scheme_name</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$g_export_options</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$g_ipa_path</span><span class="s2">"</span> 
    <span class="k">fi</span>

    <span class="c"># ç»å¯¹è·¯å¾„</span>
    <span class="nv">user_path</span><span class="o">=</span><span class="si">$(</span><span class="nb">cd</span> ~ <span class="o">&amp;&amp;</span> <span class="nb">pwd</span><span class="si">)</span>
    <span class="nv">abs_ipa_folder</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">g_ipa_path</span><span class="p">/\~/</span><span class="s2">"</span><span class="nv">$user_path</span><span class="s2">"</span><span class="k">}</span><span class="si">)</span>

    <span class="nv">ipa_path</span><span class="o">=</span><span class="s2">"</span><span class="nv">$abs_ipa_folder</span><span class="s2">/</span><span class="nv">$proj_scheme$g_current_time</span><span class="s2">/</span><span class="nv">$g_scheme_name</span><span class="s2">.ipa"</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-e</span> <span class="s2">"</span><span class="nv">$ipa_path</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"*** ipa è·¯å¾„ï¼š</span><span class="nv">$ipa_path</span><span class="s2">"</span>
    <span class="k">else
        </span><span class="nb">echo</span> <span class="s2">"*** åˆ›å»º ipa æ–‡ä»¶å¤±è´¥ ***"</span>
    <span class="k">fi

    </span><span class="nb">echo</span> <span class="s2">"*** æ‰“åŒ…å®Œæˆ ***"</span>
<span class="o">}</span>

<span class="nb">cd</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> <span class="o">||</span> <span class="nb">exit </span>0

<span class="c"># åˆ¤æ–­æœ‰æ— ä¼ é€’å‚æ•°ï¼ŒPythonè„šæœ¬ä¸­ä¼ é€’æœ‰å‚æ•°</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>Main
<span class="k">fi</span>

</code></pre></div></div>

<hr />

<h2 id="ä¸‰shell-è„šæœ¬å®Œæ•´ç‰ˆé“¾æ¥">ä¸‰ã€Shell è„šæœ¬å®Œæ•´ç‰ˆé“¾æ¥</h2>

<p>è‡ªåŠ¨æ‰“åŒ…è„šæœ¬å’Œ .app è‡ªåŠ¨è½¬æ¢ä¸º .ipa çš„è„šæœ¬ä¸‹è½½é“¾æ¥<a href="https://github.com/muzipiao/dev-shell">ä¸‹è½½é“¾æ¥</a>ã€‚</p>

<p>å¦‚æœæ‚¨è§‰å¾—æœ‰æ‰€å¸®åŠ©ï¼Œè¯·åœ¨<a href="https://github.com/muzipiao/dev-shell">GitHub dev-shell</a>ä¸Šèµä¸ªStar â­ï¸ï¼Œæ‚¨çš„é¼“åŠ±æ˜¯æˆ‘å‰è¿›çš„åŠ¨åŠ›ã€‚</p>
:ET